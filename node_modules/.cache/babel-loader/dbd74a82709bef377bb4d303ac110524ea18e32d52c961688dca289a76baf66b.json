{"ast":null,"code":"import _slicedToArray from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _inherits from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _wrapNativeSuper from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js\";\nimport _objectSpread from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _regeneratorRuntime from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _toConsumableArray from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _asyncToGenerator from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { fetch, Headers } from 'cross-fetch';\nimport { jwtVerify, importJWK, exportJWK, SignJWT, generateKeyPair } from 'jose';\nimport { v4 } from 'uuid';\nvar SOLID_CLIENT_AUTHN_KEY_PREFIX = \"solidClientAuthn:\";\nvar PREFERRED_SIGNING_ALG = [\"ES256\", \"RS256\"];\nvar EVENTS = {\n  ERROR: \"error\",\n  LOGIN: \"login\",\n  LOGOUT: \"logout\",\n  NEW_REFRESH_TOKEN: \"newRefreshToken\",\n  SESSION_EXPIRED: \"sessionExpired\",\n  SESSION_EXTENDED: \"sessionExtended\",\n  SESSION_RESTORED: \"sessionRestore\",\n  TIMEOUT_SET: \"timeoutSet\"\n};\nvar REFRESH_BEFORE_EXPIRATION_SECONDS = 5;\nvar SCOPE_OPENID = \"openid\";\nvar SCOPE_OFFLINE = \"offline_access\";\nvar SCOPE_WEBID = \"webid\";\nvar DEFAULT_SCOPES = [SCOPE_OPENID, SCOPE_OFFLINE, SCOPE_WEBID].join(\" \");\nvar AggregateHandler = /*#__PURE__*/function () {\n  function AggregateHandler(handleables) {\n    _classCallCheck(this, AggregateHandler);\n    this.handleables = handleables;\n  }\n  _createClass(AggregateHandler, [{\n    key: \"getProperHandler\",\n    value: function () {\n      var _getProperHandler = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(params) {\n        var canHandleList, i;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return Promise.all(this.handleables.map(function (handleable) {\n                return handleable.canHandle.apply(handleable, _toConsumableArray(params));\n              }));\n            case 2:\n              canHandleList = _context.sent;\n              i = 0;\n            case 4:\n              if (!(i < canHandleList.length)) {\n                _context.next = 10;\n                break;\n              }\n              if (!canHandleList[i]) {\n                _context.next = 7;\n                break;\n              }\n              return _context.abrupt(\"return\", this.handleables[i]);\n            case 7:\n              i += 1;\n              _context.next = 4;\n              break;\n            case 10:\n              return _context.abrupt(\"return\", null);\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function getProperHandler(_x) {\n        return _getProperHandler.apply(this, arguments);\n      }\n      return getProperHandler;\n    }()\n  }, {\n    key: \"canHandle\",\n    value: function () {\n      var _canHandle = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var _len,\n          params,\n          _key,\n          _args2 = arguments;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              for (_len = _args2.length, params = new Array(_len), _key = 0; _key < _len; _key++) {\n                params[_key] = _args2[_key];\n              }\n              _context2.next = 3;\n              return this.getProperHandler(params);\n            case 3:\n              _context2.t0 = _context2.sent;\n              return _context2.abrupt(\"return\", _context2.t0 !== null);\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function canHandle() {\n        return _canHandle.apply(this, arguments);\n      }\n      return canHandle;\n    }()\n  }, {\n    key: \"handle\",\n    value: function () {\n      var _handle = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var _len2,\n          params,\n          _key2,\n          handler,\n          _args3 = arguments;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              for (_len2 = _args3.length, params = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n                params[_key2] = _args3[_key2];\n              }\n              _context3.next = 3;\n              return this.getProperHandler(params);\n            case 3:\n              handler = _context3.sent;\n              if (!handler) {\n                _context3.next = 6;\n                break;\n              }\n              return _context3.abrupt(\"return\", handler.handle.apply(handler, params));\n            case 6:\n              throw new Error(\"[\".concat(this.constructor.name, \"] cannot find a suitable handler for: \").concat(params.map(function (param) {\n                try {\n                  return JSON.stringify(param);\n                } catch (err) {\n                  return param.toString();\n                }\n              }).join(\", \")));\n            case 7:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function handle() {\n        return _handle.apply(this, arguments);\n      }\n      return handle;\n    }()\n  }]);\n  return AggregateHandler;\n}();\nfunction fetchJwks(_x2, _x3) {\n  return _fetchJwks.apply(this, arguments);\n}\nfunction _fetchJwks() {\n  _fetchJwks = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee26(jwksIri, issuerIri) {\n    var jwksResponse, jwk;\n    return _regeneratorRuntime().wrap(function _callee26$(_context26) {\n      while (1) switch (_context26.prev = _context26.next) {\n        case 0:\n          _context26.next = 2;\n          return fetch(jwksIri);\n        case 2:\n          jwksResponse = _context26.sent;\n          if (!(jwksResponse.status !== 200)) {\n            _context26.next = 5;\n            break;\n          }\n          throw new Error(\"Could not fetch JWKS for [\".concat(issuerIri, \"] at [\").concat(jwksIri, \"]: \").concat(jwksResponse.status, \" \").concat(jwksResponse.statusText));\n        case 5:\n          _context26.prev = 5;\n          _context26.next = 8;\n          return jwksResponse.json();\n        case 8:\n          jwk = _context26.sent.keys[0];\n          _context26.next = 14;\n          break;\n        case 11:\n          _context26.prev = 11;\n          _context26.t0 = _context26[\"catch\"](5);\n          throw new Error(\"Malformed JWKS for [\".concat(issuerIri, \"] at [\").concat(jwksIri, \"]: \").concat(_context26.t0.message));\n        case 14:\n          return _context26.abrupt(\"return\", jwk);\n        case 15:\n        case \"end\":\n          return _context26.stop();\n      }\n    }, _callee26, null, [[5, 11]]);\n  }));\n  return _fetchJwks.apply(this, arguments);\n}\nfunction getWebidFromTokenPayload(_x4, _x5, _x6, _x7) {\n  return _getWebidFromTokenPayload.apply(this, arguments);\n}\nfunction _getWebidFromTokenPayload() {\n  _getWebidFromTokenPayload = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee27(idToken, jwksIri, issuerIri, clientId) {\n    var jwk, payload, _yield$jwtVerify, verifiedPayload;\n    return _regeneratorRuntime().wrap(function _callee27$(_context27) {\n      while (1) switch (_context27.prev = _context27.next) {\n        case 0:\n          _context27.next = 2;\n          return fetchJwks(jwksIri, issuerIri);\n        case 2:\n          jwk = _context27.sent;\n          _context27.prev = 3;\n          _context27.t0 = jwtVerify;\n          _context27.t1 = idToken;\n          _context27.next = 8;\n          return importJWK(jwk);\n        case 8:\n          _context27.t2 = _context27.sent;\n          _context27.t3 = {\n            issuer: issuerIri,\n            audience: clientId\n          };\n          _context27.next = 12;\n          return (0, _context27.t0)(_context27.t1, _context27.t2, _context27.t3);\n        case 12:\n          _yield$jwtVerify = _context27.sent;\n          verifiedPayload = _yield$jwtVerify.payload;\n          payload = verifiedPayload;\n          _context27.next = 20;\n          break;\n        case 17:\n          _context27.prev = 17;\n          _context27.t4 = _context27[\"catch\"](3);\n          throw new Error(\"Token verification failed: \".concat(_context27.t4.stack));\n        case 20:\n          if (!(typeof payload.webid === \"string\")) {\n            _context27.next = 22;\n            break;\n          }\n          return _context27.abrupt(\"return\", payload.webid);\n        case 22:\n          if (!(typeof payload.sub !== \"string\")) {\n            _context27.next = 24;\n            break;\n          }\n          throw new Error(\"The token \".concat(JSON.stringify(payload), \" is invalid: it has no 'webid' claim and no 'sub' claim.\"));\n        case 24:\n          _context27.prev = 24;\n          new URL(payload.sub);\n          return _context27.abrupt(\"return\", payload.sub);\n        case 29:\n          _context27.prev = 29;\n          _context27.t5 = _context27[\"catch\"](24);\n          throw new Error(\"The token has no 'webid' claim, and its 'sub' claim of [\".concat(payload.sub, \"] is invalid as a URL - error [\").concat(_context27.t5, \"].\"));\n        case 32:\n        case \"end\":\n          return _context27.stop();\n      }\n    }, _callee27, null, [[3, 17], [24, 29]]);\n  }));\n  return _getWebidFromTokenPayload.apply(this, arguments);\n}\nfunction isSupportedTokenType(token) {\n  return typeof token === \"string\" && [\"DPoP\", \"Bearer\"].includes(token);\n}\nvar USER_SESSION_PREFIX = \"solidClientAuthenticationUser\";\nfunction isValidUrl(url) {\n  try {\n    new URL(url);\n    return true;\n  } catch (_a) {\n    return false;\n  }\n}\nfunction determineSigningAlg(supported, preferred) {\n  var _a;\n  return (_a = preferred.find(function (signingAlg) {\n    return supported.includes(signingAlg);\n  })) !== null && _a !== void 0 ? _a : null;\n}\nfunction determineClientType(options, issuerConfig) {\n  if (options.clientId !== undefined && !isValidUrl(options.clientId)) {\n    return \"static\";\n  }\n  if (issuerConfig.scopesSupported.includes(\"webid\") && options.clientId !== undefined && isValidUrl(options.clientId)) {\n    return \"solid-oidc\";\n  }\n  return \"dynamic\";\n}\nfunction handleRegistration(_x8, _x9, _x10, _x11) {\n  return _handleRegistration.apply(this, arguments);\n}\nfunction _handleRegistration() {\n  _handleRegistration = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee28(options, issuerConfig, storageUtility, clientRegistrar) {\n    var clientType;\n    return _regeneratorRuntime().wrap(function _callee28$(_context28) {\n      while (1) switch (_context28.prev = _context28.next) {\n        case 0:\n          clientType = determineClientType(options, issuerConfig);\n          if (!(clientType === \"dynamic\")) {\n            _context28.next = 3;\n            break;\n          }\n          return _context28.abrupt(\"return\", clientRegistrar.getClient({\n            sessionId: options.sessionId,\n            clientName: options.clientName,\n            redirectUrl: options.redirectUrl\n          }, issuerConfig));\n        case 3:\n          _context28.next = 5;\n          return storageUtility.setForUser(options.sessionId, {\n            clientId: options.clientId\n          });\n        case 5:\n          if (!options.clientSecret) {\n            _context28.next = 8;\n            break;\n          }\n          _context28.next = 8;\n          return storageUtility.setForUser(options.sessionId, {\n            clientSecret: options.clientSecret\n          });\n        case 8:\n          if (!options.clientName) {\n            _context28.next = 11;\n            break;\n          }\n          _context28.next = 11;\n          return storageUtility.setForUser(options.sessionId, {\n            clientName: options.clientName\n          });\n        case 11:\n          return _context28.abrupt(\"return\", {\n            clientId: options.clientId,\n            clientSecret: options.clientSecret,\n            clientName: options.clientName,\n            clientType: clientType\n          });\n        case 12:\n        case \"end\":\n          return _context28.stop();\n      }\n    }, _callee28);\n  }));\n  return _handleRegistration.apply(this, arguments);\n}\nfunction getSessionIdFromOauthState(_x12, _x13) {\n  return _getSessionIdFromOauthState.apply(this, arguments);\n}\nfunction _getSessionIdFromOauthState() {\n  _getSessionIdFromOauthState = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee29(storageUtility, oauthState) {\n    return _regeneratorRuntime().wrap(function _callee29$(_context29) {\n      while (1) switch (_context29.prev = _context29.next) {\n        case 0:\n          return _context29.abrupt(\"return\", storageUtility.getForUser(oauthState, \"sessionId\"));\n        case 1:\n        case \"end\":\n          return _context29.stop();\n      }\n    }, _callee29);\n  }));\n  return _getSessionIdFromOauthState.apply(this, arguments);\n}\nfunction loadOidcContextFromStorage(_x14, _x15, _x16) {\n  return _loadOidcContextFromStorage.apply(this, arguments);\n}\nfunction _loadOidcContextFromStorage() {\n  _loadOidcContextFromStorage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee30(sessionId, storageUtility, configFetcher) {\n    var _yield$Promise$all, _yield$Promise$all2, issuerIri, codeVerifier, storedRedirectIri, dpop, issuerConfig;\n    return _regeneratorRuntime().wrap(function _callee30$(_context30) {\n      while (1) switch (_context30.prev = _context30.next) {\n        case 0:\n          _context30.prev = 0;\n          _context30.next = 3;\n          return Promise.all([storageUtility.getForUser(sessionId, \"issuer\", {\n            errorIfNull: true\n          }), storageUtility.getForUser(sessionId, \"codeVerifier\"), storageUtility.getForUser(sessionId, \"redirectUrl\"), storageUtility.getForUser(sessionId, \"dpop\", {\n            errorIfNull: true\n          })]);\n        case 3:\n          _yield$Promise$all = _context30.sent;\n          _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 4);\n          issuerIri = _yield$Promise$all2[0];\n          codeVerifier = _yield$Promise$all2[1];\n          storedRedirectIri = _yield$Promise$all2[2];\n          dpop = _yield$Promise$all2[3];\n          _context30.next = 11;\n          return storageUtility.deleteForUser(sessionId, \"codeVerifier\");\n        case 11:\n          _context30.next = 13;\n          return configFetcher.fetchConfig(issuerIri);\n        case 13:\n          issuerConfig = _context30.sent;\n          return _context30.abrupt(\"return\", {\n            codeVerifier: codeVerifier,\n            redirectUrl: storedRedirectIri,\n            issuerConfig: issuerConfig,\n            dpop: dpop === \"true\"\n          });\n        case 17:\n          _context30.prev = 17;\n          _context30.t0 = _context30[\"catch\"](0);\n          throw new Error(\"Failed to retrieve OIDC context from storage associated with session [\".concat(sessionId, \"]: \").concat(_context30.t0));\n        case 20:\n        case \"end\":\n          return _context30.stop();\n      }\n    }, _callee30, null, [[0, 17]]);\n  }));\n  return _loadOidcContextFromStorage.apply(this, arguments);\n}\nfunction saveSessionInfoToStorage(_x17, _x18, _x19, _x20, _x21, _x22, _x23) {\n  return _saveSessionInfoToStorage.apply(this, arguments);\n}\nfunction _saveSessionInfoToStorage() {\n  _saveSessionInfoToStorage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee31(storageUtility, sessionId, webId, isLoggedIn, refreshToken, secure, dpopKey) {\n    return _regeneratorRuntime().wrap(function _callee31$(_context31) {\n      while (1) switch (_context31.prev = _context31.next) {\n        case 0:\n          if (!(refreshToken !== undefined)) {\n            _context31.next = 3;\n            break;\n          }\n          _context31.next = 3;\n          return storageUtility.setForUser(sessionId, {\n            refreshToken: refreshToken\n          }, {\n            secure: secure\n          });\n        case 3:\n          if (!(webId !== undefined)) {\n            _context31.next = 6;\n            break;\n          }\n          _context31.next = 6;\n          return storageUtility.setForUser(sessionId, {\n            webId: webId\n          }, {\n            secure: secure\n          });\n        case 6:\n          if (!(isLoggedIn !== undefined)) {\n            _context31.next = 9;\n            break;\n          }\n          _context31.next = 9;\n          return storageUtility.setForUser(sessionId, {\n            isLoggedIn: isLoggedIn\n          }, {\n            secure: secure\n          });\n        case 9:\n          if (!(dpopKey !== undefined)) {\n            _context31.next = 22;\n            break;\n          }\n          _context31.t0 = storageUtility;\n          _context31.t1 = sessionId;\n          _context31.t2 = JSON.stringify(dpopKey.publicKey);\n          _context31.t3 = JSON;\n          _context31.next = 16;\n          return exportJWK(dpopKey.privateKey);\n        case 16:\n          _context31.t4 = _context31.sent;\n          _context31.t5 = _context31.t3.stringify.call(_context31.t3, _context31.t4);\n          _context31.t6 = {\n            publicKey: _context31.t2,\n            privateKey: _context31.t5\n          };\n          _context31.t7 = {\n            secure: secure\n          };\n          _context31.next = 22;\n          return _context31.t0.setForUser.call(_context31.t0, _context31.t1, _context31.t6, _context31.t7);\n        case 22:\n        case \"end\":\n          return _context31.stop();\n      }\n    }, _callee31);\n  }));\n  return _saveSessionInfoToStorage.apply(this, arguments);\n}\nvar StorageUtility = /*#__PURE__*/function () {\n  function StorageUtility(secureStorage, insecureStorage) {\n    _classCallCheck(this, StorageUtility);\n    this.secureStorage = secureStorage;\n    this.insecureStorage = insecureStorage;\n  }\n  _createClass(StorageUtility, [{\n    key: \"getKey\",\n    value: function getKey(userId) {\n      return \"solidClientAuthenticationUser:\".concat(userId);\n    }\n  }, {\n    key: \"getUserData\",\n    value: function () {\n      var _getUserData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(userId, secure) {\n        var stored;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return (secure ? this.secureStorage : this.insecureStorage).get(this.getKey(userId));\n            case 2:\n              stored = _context4.sent;\n              if (!(stored === undefined)) {\n                _context4.next = 5;\n                break;\n              }\n              return _context4.abrupt(\"return\", {});\n            case 5:\n              _context4.prev = 5;\n              return _context4.abrupt(\"return\", JSON.parse(stored));\n            case 9:\n              _context4.prev = 9;\n              _context4.t0 = _context4[\"catch\"](5);\n              throw new Error(\"Data for user [\".concat(userId, \"] in [\").concat(secure ? \"secure\" : \"unsecure\", \"] storage is corrupted - expected valid JSON, but got: \").concat(stored));\n            case 12:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[5, 9]]);\n      }));\n      function getUserData(_x24, _x25) {\n        return _getUserData.apply(this, arguments);\n      }\n      return getUserData;\n    }()\n  }, {\n    key: \"setUserData\",\n    value: function () {\n      var _setUserData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5(userId, data, secure) {\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return (secure ? this.secureStorage : this.insecureStorage).set(this.getKey(userId), JSON.stringify(data));\n            case 2:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, this);\n      }));\n      function setUserData(_x26, _x27, _x28) {\n        return _setUserData.apply(this, arguments);\n      }\n      return setUserData;\n    }()\n  }, {\n    key: \"get\",\n    value: function () {\n      var _get = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6(key, options) {\n        var value;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return ((options === null || options === void 0 ? void 0 : options.secure) ? this.secureStorage : this.insecureStorage).get(key);\n            case 2:\n              value = _context6.sent;\n              if (!(value === undefined && (options === null || options === void 0 ? void 0 : options.errorIfNull))) {\n                _context6.next = 5;\n                break;\n              }\n              throw new Error(\"[\".concat(key, \"] is not stored\"));\n            case 5:\n              return _context6.abrupt(\"return\", value);\n            case 6:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee6, this);\n      }));\n      function get(_x29, _x30) {\n        return _get.apply(this, arguments);\n      }\n      return get;\n    }()\n  }, {\n    key: \"set\",\n    value: function () {\n      var _set = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7(key, value, options) {\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              return _context7.abrupt(\"return\", ((options === null || options === void 0 ? void 0 : options.secure) ? this.secureStorage : this.insecureStorage).set(key, value));\n            case 1:\n            case \"end\":\n              return _context7.stop();\n          }\n        }, _callee7, this);\n      }));\n      function set(_x31, _x32, _x33) {\n        return _set.apply(this, arguments);\n      }\n      return set;\n    }()\n  }, {\n    key: \"delete\",\n    value: function () {\n      var _delete2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8(key, options) {\n        return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              return _context8.abrupt(\"return\", ((options === null || options === void 0 ? void 0 : options.secure) ? this.secureStorage : this.insecureStorage).delete(key));\n            case 1:\n            case \"end\":\n              return _context8.stop();\n          }\n        }, _callee8, this);\n      }));\n      function _delete(_x34, _x35) {\n        return _delete2.apply(this, arguments);\n      }\n      return _delete;\n    }()\n  }, {\n    key: \"getForUser\",\n    value: function () {\n      var _getForUser = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee9(userId, key, options) {\n        var userData, value;\n        return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n          while (1) switch (_context9.prev = _context9.next) {\n            case 0:\n              _context9.next = 2;\n              return this.getUserData(userId, options === null || options === void 0 ? void 0 : options.secure);\n            case 2:\n              userData = _context9.sent;\n              if (!userData || !userData[key]) {\n                value = undefined;\n              }\n              value = userData[key];\n              if (!(value === undefined && (options === null || options === void 0 ? void 0 : options.errorIfNull))) {\n                _context9.next = 7;\n                break;\n              }\n              throw new Error(\"Field [\".concat(key, \"] for user [\").concat(userId, \"] is not stored\"));\n            case 7:\n              return _context9.abrupt(\"return\", value || undefined);\n            case 8:\n            case \"end\":\n              return _context9.stop();\n          }\n        }, _callee9, this);\n      }));\n      function getForUser(_x36, _x37, _x38) {\n        return _getForUser.apply(this, arguments);\n      }\n      return getForUser;\n    }()\n  }, {\n    key: \"setForUser\",\n    value: function () {\n      var _setForUser = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee10(userId, values, options) {\n        var userData;\n        return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n          while (1) switch (_context10.prev = _context10.next) {\n            case 0:\n              _context10.prev = 0;\n              _context10.next = 3;\n              return this.getUserData(userId, options === null || options === void 0 ? void 0 : options.secure);\n            case 3:\n              userData = _context10.sent;\n              _context10.next = 9;\n              break;\n            case 6:\n              _context10.prev = 6;\n              _context10.t0 = _context10[\"catch\"](0);\n              userData = {};\n            case 9:\n              _context10.next = 11;\n              return this.setUserData(userId, _objectSpread(_objectSpread({}, userData), values), options === null || options === void 0 ? void 0 : options.secure);\n            case 11:\n            case \"end\":\n              return _context10.stop();\n          }\n        }, _callee10, this, [[0, 6]]);\n      }));\n      function setForUser(_x39, _x40, _x41) {\n        return _setForUser.apply(this, arguments);\n      }\n      return setForUser;\n    }()\n  }, {\n    key: \"deleteForUser\",\n    value: function () {\n      var _deleteForUser = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee11(userId, key, options) {\n        var userData;\n        return _regeneratorRuntime().wrap(function _callee11$(_context11) {\n          while (1) switch (_context11.prev = _context11.next) {\n            case 0:\n              _context11.next = 2;\n              return this.getUserData(userId, options === null || options === void 0 ? void 0 : options.secure);\n            case 2:\n              userData = _context11.sent;\n              delete userData[key];\n              _context11.next = 6;\n              return this.setUserData(userId, userData, options === null || options === void 0 ? void 0 : options.secure);\n            case 6:\n            case \"end\":\n              return _context11.stop();\n          }\n        }, _callee11, this);\n      }));\n      function deleteForUser(_x42, _x43, _x44) {\n        return _deleteForUser.apply(this, arguments);\n      }\n      return deleteForUser;\n    }()\n  }, {\n    key: \"deleteAllUserData\",\n    value: function () {\n      var _deleteAllUserData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee12(userId, options) {\n        return _regeneratorRuntime().wrap(function _callee12$(_context12) {\n          while (1) switch (_context12.prev = _context12.next) {\n            case 0:\n              _context12.next = 2;\n              return ((options === null || options === void 0 ? void 0 : options.secure) ? this.secureStorage : this.insecureStorage).delete(this.getKey(userId));\n            case 2:\n            case \"end\":\n              return _context12.stop();\n          }\n        }, _callee12, this);\n      }));\n      function deleteAllUserData(_x45, _x46) {\n        return _deleteAllUserData.apply(this, arguments);\n      }\n      return deleteAllUserData;\n    }()\n  }]);\n  return StorageUtility;\n}();\nvar InMemoryStorage = /*#__PURE__*/function () {\n  function InMemoryStorage() {\n    _classCallCheck(this, InMemoryStorage);\n    this.map = {};\n  }\n  _createClass(InMemoryStorage, [{\n    key: \"get\",\n    value: function () {\n      var _get2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee13(key) {\n        return _regeneratorRuntime().wrap(function _callee13$(_context13) {\n          while (1) switch (_context13.prev = _context13.next) {\n            case 0:\n              return _context13.abrupt(\"return\", this.map[key] || undefined);\n            case 1:\n            case \"end\":\n              return _context13.stop();\n          }\n        }, _callee13, this);\n      }));\n      function get(_x47) {\n        return _get2.apply(this, arguments);\n      }\n      return get;\n    }()\n  }, {\n    key: \"set\",\n    value: function () {\n      var _set2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee14(key, value) {\n        return _regeneratorRuntime().wrap(function _callee14$(_context14) {\n          while (1) switch (_context14.prev = _context14.next) {\n            case 0:\n              this.map[key] = value;\n            case 1:\n            case \"end\":\n              return _context14.stop();\n          }\n        }, _callee14, this);\n      }));\n      function set(_x48, _x49) {\n        return _set2.apply(this, arguments);\n      }\n      return set;\n    }()\n  }, {\n    key: \"delete\",\n    value: function () {\n      var _delete3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee15(key) {\n        return _regeneratorRuntime().wrap(function _callee15$(_context15) {\n          while (1) switch (_context15.prev = _context15.next) {\n            case 0:\n              delete this.map[key];\n            case 1:\n            case \"end\":\n              return _context15.stop();\n          }\n        }, _callee15, this);\n      }));\n      function _delete(_x50) {\n        return _delete3.apply(this, arguments);\n      }\n      return _delete;\n    }()\n  }]);\n  return InMemoryStorage;\n}();\nvar ConfigurationError = /*#__PURE__*/function (_Error) {\n  _inherits(ConfigurationError, _Error);\n  var _super = _createSuper(ConfigurationError);\n  function ConfigurationError(message) {\n    _classCallCheck(this, ConfigurationError);\n    return _super.call(this, message);\n  }\n  return _createClass(ConfigurationError);\n}( /*#__PURE__*/_wrapNativeSuper(Error));\nvar NotImplementedError = /*#__PURE__*/function (_Error2) {\n  _inherits(NotImplementedError, _Error2);\n  var _super2 = _createSuper(NotImplementedError);\n  function NotImplementedError(methodName) {\n    _classCallCheck(this, NotImplementedError);\n    return _super2.call(this, \"[\".concat(methodName, \"] is not implemented\"));\n  }\n  return _createClass(NotImplementedError);\n}( /*#__PURE__*/_wrapNativeSuper(Error));\nvar InvalidResponseError = /*#__PURE__*/function (_Error3) {\n  _inherits(InvalidResponseError, _Error3);\n  var _super3 = _createSuper(InvalidResponseError);\n  function InvalidResponseError(missingFields) {\n    var _this;\n    _classCallCheck(this, InvalidResponseError);\n    _this = _super3.call(this, \"Invalid response from OIDC provider: missing fields \".concat(missingFields));\n    _this.missingFields = missingFields;\n    return _this;\n  }\n  return _createClass(InvalidResponseError);\n}( /*#__PURE__*/_wrapNativeSuper(Error));\nvar OidcProviderError = /*#__PURE__*/function (_Error4) {\n  _inherits(OidcProviderError, _Error4);\n  var _super4 = _createSuper(OidcProviderError);\n  function OidcProviderError(message, error, errorDescription) {\n    var _this2;\n    _classCallCheck(this, OidcProviderError);\n    _this2 = _super4.call(this, message);\n    _this2.error = error;\n    _this2.errorDescription = errorDescription;\n    return _this2;\n  }\n  return _createClass(OidcProviderError);\n}( /*#__PURE__*/_wrapNativeSuper(Error));\nfunction normalizeHTU(audience) {\n  var audienceUrl = new URL(audience);\n  return new URL(audienceUrl.pathname, audienceUrl.origin).toString();\n}\nfunction createDpopHeader(_x51, _x52, _x53) {\n  return _createDpopHeader.apply(this, arguments);\n}\nfunction _createDpopHeader() {\n  _createDpopHeader = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee32(audience, method, dpopKey) {\n    return _regeneratorRuntime().wrap(function _callee32$(_context32) {\n      while (1) switch (_context32.prev = _context32.next) {\n        case 0:\n          return _context32.abrupt(\"return\", new SignJWT({\n            htu: normalizeHTU(audience),\n            htm: method.toUpperCase(),\n            jti: v4()\n          }).setProtectedHeader({\n            alg: PREFERRED_SIGNING_ALG[0],\n            jwk: dpopKey.publicKey,\n            typ: \"dpop+jwt\"\n          }).setIssuedAt().sign(dpopKey.privateKey, {}));\n        case 1:\n        case \"end\":\n          return _context32.stop();\n      }\n    }, _callee32);\n  }));\n  return _createDpopHeader.apply(this, arguments);\n}\nfunction generateDpopKeyPair() {\n  return _generateDpopKeyPair.apply(this, arguments);\n}\nfunction _generateDpopKeyPair() {\n  _generateDpopKeyPair = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee33() {\n    var _yield$generateKeyPai, privateKey, publicKey, dpopKeyPair;\n    return _regeneratorRuntime().wrap(function _callee33$(_context33) {\n      while (1) switch (_context33.prev = _context33.next) {\n        case 0:\n          _context33.next = 2;\n          return generateKeyPair(PREFERRED_SIGNING_ALG[0]);\n        case 2:\n          _yield$generateKeyPai = _context33.sent;\n          privateKey = _yield$generateKeyPai.privateKey;\n          publicKey = _yield$generateKeyPai.publicKey;\n          _context33.t0 = privateKey;\n          _context33.next = 8;\n          return exportJWK(publicKey);\n        case 8:\n          _context33.t1 = _context33.sent;\n          dpopKeyPair = {\n            privateKey: _context33.t0,\n            publicKey: _context33.t1\n          };\n          dpopKeyPair.publicKey.alg = PREFERRED_SIGNING_ALG[0];\n          return _context33.abrupt(\"return\", dpopKeyPair);\n        case 12:\n        case \"end\":\n          return _context33.stop();\n      }\n    }, _callee33);\n  }));\n  return _generateDpopKeyPair.apply(this, arguments);\n}\nvar DEFAULT_EXPIRATION_TIME_SECONDS = 600;\nfunction isExpectedAuthError(statusCode) {\n  return [401, 403].includes(statusCode);\n}\nfunction buildDpopFetchOptions(_x54, _x55, _x56, _x57) {\n  return _buildDpopFetchOptions.apply(this, arguments);\n}\nfunction _buildDpopFetchOptions() {\n  _buildDpopFetchOptions = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee34(targetUrl, authToken, dpopKey, defaultOptions) {\n    var _a, headers;\n    return _regeneratorRuntime().wrap(function _callee34$(_context34) {\n      while (1) switch (_context34.prev = _context34.next) {\n        case 0:\n          headers = new Headers(defaultOptions === null || defaultOptions === void 0 ? void 0 : defaultOptions.headers);\n          headers.set(\"Authorization\", \"DPoP \".concat(authToken));\n          _context34.t0 = headers;\n          _context34.next = 5;\n          return createDpopHeader(targetUrl, (_a = defaultOptions === null || defaultOptions === void 0 ? void 0 : defaultOptions.method) !== null && _a !== void 0 ? _a : \"get\", dpopKey);\n        case 5:\n          _context34.t1 = _context34.sent;\n          _context34.t0.set.call(_context34.t0, \"DPoP\", _context34.t1);\n          return _context34.abrupt(\"return\", _objectSpread(_objectSpread({}, defaultOptions), {}, {\n            headers: headers\n          }));\n        case 8:\n        case \"end\":\n          return _context34.stop();\n      }\n    }, _callee34);\n  }));\n  return _buildDpopFetchOptions.apply(this, arguments);\n}\nfunction buildAuthenticatedHeaders(_x58, _x59, _x60, _x61) {\n  return _buildAuthenticatedHeaders.apply(this, arguments);\n}\nfunction _buildAuthenticatedHeaders() {\n  _buildAuthenticatedHeaders = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee35(targetUrl, authToken, dpopKey, defaultOptions) {\n    var headers;\n    return _regeneratorRuntime().wrap(function _callee35$(_context35) {\n      while (1) switch (_context35.prev = _context35.next) {\n        case 0:\n          if (!(dpopKey !== undefined)) {\n            _context35.next = 2;\n            break;\n          }\n          return _context35.abrupt(\"return\", buildDpopFetchOptions(targetUrl, authToken, dpopKey, defaultOptions));\n        case 2:\n          headers = new Headers(defaultOptions === null || defaultOptions === void 0 ? void 0 : defaultOptions.headers);\n          headers.set(\"Authorization\", \"Bearer \".concat(authToken));\n          return _context35.abrupt(\"return\", _objectSpread(_objectSpread({}, defaultOptions), {}, {\n            headers: headers\n          }));\n        case 5:\n        case \"end\":\n          return _context35.stop();\n      }\n    }, _callee35);\n  }));\n  return _buildAuthenticatedHeaders.apply(this, arguments);\n}\nfunction makeAuthenticatedRequest(_x62, _x63, _x64, _x65, _x66) {\n  return _makeAuthenticatedRequest.apply(this, arguments);\n}\nfunction _makeAuthenticatedRequest() {\n  _makeAuthenticatedRequest = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee36(unauthFetch, accessToken, url, defaultRequestInit, dpopKey) {\n    return _regeneratorRuntime().wrap(function _callee36$(_context36) {\n      while (1) switch (_context36.prev = _context36.next) {\n        case 0:\n          _context36.t0 = unauthFetch;\n          _context36.t1 = url;\n          _context36.next = 4;\n          return buildAuthenticatedHeaders(url.toString(), accessToken, dpopKey, defaultRequestInit);\n        case 4:\n          _context36.t2 = _context36.sent;\n          return _context36.abrupt(\"return\", (0, _context36.t0)(_context36.t1, _context36.t2));\n        case 6:\n        case \"end\":\n          return _context36.stop();\n      }\n    }, _callee36);\n  }));\n  return _makeAuthenticatedRequest.apply(this, arguments);\n}\nfunction refreshAccessToken(_x67, _x68, _x69) {\n  return _refreshAccessToken.apply(this, arguments);\n}\nfunction _refreshAccessToken() {\n  _refreshAccessToken = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee37(refreshOptions, dpopKey, eventEmitter) {\n    var _a, tokenSet;\n    return _regeneratorRuntime().wrap(function _callee37$(_context37) {\n      while (1) switch (_context37.prev = _context37.next) {\n        case 0:\n          _context37.next = 2;\n          return refreshOptions.tokenRefresher.refresh(refreshOptions.sessionId, refreshOptions.refreshToken, dpopKey);\n        case 2:\n          tokenSet = _context37.sent;\n          eventEmitter === null || eventEmitter === void 0 ? void 0 : eventEmitter.emit(EVENTS.SESSION_EXTENDED, (_a = tokenSet.expiresIn) !== null && _a !== void 0 ? _a : DEFAULT_EXPIRATION_TIME_SECONDS);\n          if (typeof tokenSet.refreshToken === \"string\") {\n            eventEmitter === null || eventEmitter === void 0 ? void 0 : eventEmitter.emit(EVENTS.NEW_REFRESH_TOKEN, tokenSet.refreshToken);\n          }\n          return _context37.abrupt(\"return\", {\n            accessToken: tokenSet.accessToken,\n            refreshToken: tokenSet.refreshToken,\n            expiresIn: tokenSet.expiresIn\n          });\n        case 6:\n        case \"end\":\n          return _context37.stop();\n      }\n    }, _callee37);\n  }));\n  return _refreshAccessToken.apply(this, arguments);\n}\nvar computeRefreshDelay = function computeRefreshDelay(expiresIn) {\n  if (expiresIn !== undefined) {\n    return expiresIn - REFRESH_BEFORE_EXPIRATION_SECONDS > 0 ? expiresIn - REFRESH_BEFORE_EXPIRATION_SECONDS : expiresIn;\n  }\n  return DEFAULT_EXPIRATION_TIME_SECONDS;\n};\nfunction buildAuthenticatedFetch(_x70, _x71, _x72) {\n  return _buildAuthenticatedFetch.apply(this, arguments);\n}\nfunction _buildAuthenticatedFetch() {\n  _buildAuthenticatedFetch = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee40(unauthFetch, accessToken, options) {\n    var _a, currentAccessToken, latestTimeout, currentRefreshOptions, proactivelyRefreshToken, expirationTimeout;\n    return _regeneratorRuntime().wrap(function _callee40$(_context40) {\n      while (1) switch (_context40.prev = _context40.next) {\n        case 0:\n          currentAccessToken = accessToken;\n          currentRefreshOptions = options === null || options === void 0 ? void 0 : options.refreshOptions;\n          if (currentRefreshOptions !== undefined) {\n            proactivelyRefreshToken = /*#__PURE__*/function () {\n              var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee38() {\n                var _a, _b, _c, _d, _yield$refreshAccessT, refreshedAccessToken, refreshToken, expiresIn;\n                return _regeneratorRuntime().wrap(function _callee38$(_context38) {\n                  while (1) switch (_context38.prev = _context38.next) {\n                    case 0:\n                      _context38.prev = 0;\n                      _context38.next = 3;\n                      return refreshAccessToken(currentRefreshOptions, options.dpopKey, options.eventEmitter);\n                    case 3:\n                      _yield$refreshAccessT = _context38.sent;\n                      refreshedAccessToken = _yield$refreshAccessT.accessToken;\n                      refreshToken = _yield$refreshAccessT.refreshToken;\n                      expiresIn = _yield$refreshAccessT.expiresIn;\n                      currentAccessToken = refreshedAccessToken;\n                      if (refreshToken !== undefined) {\n                        currentRefreshOptions.refreshToken = refreshToken;\n                      }\n                      clearTimeout(latestTimeout);\n                      latestTimeout = setTimeout(proactivelyRefreshToken, computeRefreshDelay(expiresIn) * 1000);\n                      (_a = options.eventEmitter) === null || _a === void 0 ? void 0 : _a.emit(EVENTS.TIMEOUT_SET, latestTimeout);\n                      _context38.next = 18;\n                      break;\n                    case 14:\n                      _context38.prev = 14;\n                      _context38.t0 = _context38[\"catch\"](0);\n                      if (_context38.t0 instanceof OidcProviderError) {\n                        (_b = options === null || options === void 0 ? void 0 : options.eventEmitter) === null || _b === void 0 ? void 0 : _b.emit(EVENTS.ERROR, _context38.t0.error, _context38.t0.errorDescription);\n                        (_c = options === null || options === void 0 ? void 0 : options.eventEmitter) === null || _c === void 0 ? void 0 : _c.emit(EVENTS.SESSION_EXPIRED);\n                      }\n                      if (_context38.t0 instanceof InvalidResponseError && _context38.t0.missingFields.includes(\"access_token\")) {\n                        (_d = options === null || options === void 0 ? void 0 : options.eventEmitter) === null || _d === void 0 ? void 0 : _d.emit(EVENTS.SESSION_EXPIRED);\n                      }\n                    case 18:\n                    case \"end\":\n                      return _context38.stop();\n                  }\n                }, _callee38, null, [[0, 14]]);\n              }));\n              return function proactivelyRefreshToken() {\n                return _ref.apply(this, arguments);\n              };\n            }();\n            latestTimeout = setTimeout(proactivelyRefreshToken, computeRefreshDelay(options.expiresIn) * 1000);\n            (_a = options.eventEmitter) === null || _a === void 0 ? void 0 : _a.emit(EVENTS.TIMEOUT_SET, latestTimeout);\n          } else if (options !== undefined && options.eventEmitter !== undefined) {\n            expirationTimeout = setTimeout(function () {\n              options.eventEmitter.emit(EVENTS.SESSION_EXPIRED);\n            }, computeRefreshDelay(options.expiresIn) * 1000);\n            options.eventEmitter.emit(EVENTS.TIMEOUT_SET, expirationTimeout);\n          }\n          return _context40.abrupt(\"return\", /*#__PURE__*/function () {\n            var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee39(url, requestInit) {\n              var response, failedButNotExpectedAuthError, hasBeenRedirected;\n              return _regeneratorRuntime().wrap(function _callee39$(_context39) {\n                while (1) switch (_context39.prev = _context39.next) {\n                  case 0:\n                    _context39.next = 2;\n                    return makeAuthenticatedRequest(unauthFetch, currentAccessToken, url, requestInit, options === null || options === void 0 ? void 0 : options.dpopKey);\n                  case 2:\n                    response = _context39.sent;\n                    failedButNotExpectedAuthError = !response.ok && !isExpectedAuthError(response.status);\n                    if (!(response.ok || failedButNotExpectedAuthError)) {\n                      _context39.next = 6;\n                      break;\n                    }\n                    return _context39.abrupt(\"return\", response);\n                  case 6:\n                    hasBeenRedirected = response.url !== url;\n                    if (!(hasBeenRedirected && (options === null || options === void 0 ? void 0 : options.dpopKey) !== undefined)) {\n                      _context39.next = 11;\n                      break;\n                    }\n                    _context39.next = 10;\n                    return makeAuthenticatedRequest(unauthFetch, currentAccessToken, response.url, requestInit, options.dpopKey);\n                  case 10:\n                    response = _context39.sent;\n                  case 11:\n                    return _context39.abrupt(\"return\", response);\n                  case 12:\n                  case \"end\":\n                    return _context39.stop();\n                }\n              }, _callee39);\n            }));\n            return function (_x93, _x94) {\n              return _ref2.apply(this, arguments);\n            };\n          }());\n        case 4:\n        case \"end\":\n          return _context40.stop();\n      }\n    }, _callee40);\n  }));\n  return _buildAuthenticatedFetch.apply(this, arguments);\n}\nvar StorageUtilityGetResponse = \"getResponse\";\nvar StorageUtilityMock = {\n  get: function () {\n    var _get3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee16(key, options) {\n      return _regeneratorRuntime().wrap(function _callee16$(_context16) {\n        while (1) switch (_context16.prev = _context16.next) {\n          case 0:\n            return _context16.abrupt(\"return\", StorageUtilityGetResponse);\n          case 1:\n          case \"end\":\n            return _context16.stop();\n        }\n      }, _callee16);\n    }));\n    function get(_x73, _x74) {\n      return _get3.apply(this, arguments);\n    }\n    return get;\n  }(),\n  set: function () {\n    var _set3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee17(key, value) {\n      return _regeneratorRuntime().wrap(function _callee17$(_context17) {\n        while (1) switch (_context17.prev = _context17.next) {\n          case 0:\n          case \"end\":\n            return _context17.stop();\n        }\n      }, _callee17);\n    }));\n    function set(_x75, _x76) {\n      return _set3.apply(this, arguments);\n    }\n    return set;\n  }(),\n  delete: function () {\n    var _delete4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee18(key) {\n      return _regeneratorRuntime().wrap(function _callee18$(_context18) {\n        while (1) switch (_context18.prev = _context18.next) {\n          case 0:\n          case \"end\":\n            return _context18.stop();\n        }\n      }, _callee18);\n    }));\n    function _delete(_x77) {\n      return _delete4.apply(this, arguments);\n    }\n    return _delete;\n  }(),\n  getForUser: function () {\n    var _getForUser2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee19(userId, key, options) {\n      return _regeneratorRuntime().wrap(function _callee19$(_context19) {\n        while (1) switch (_context19.prev = _context19.next) {\n          case 0:\n            return _context19.abrupt(\"return\", StorageUtilityGetResponse);\n          case 1:\n          case \"end\":\n            return _context19.stop();\n        }\n      }, _callee19);\n    }));\n    function getForUser(_x78, _x79, _x80) {\n      return _getForUser2.apply(this, arguments);\n    }\n    return getForUser;\n  }(),\n  setForUser: function () {\n    var _setForUser2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee20(userId, values, options) {\n      return _regeneratorRuntime().wrap(function _callee20$(_context20) {\n        while (1) switch (_context20.prev = _context20.next) {\n          case 0:\n          case \"end\":\n            return _context20.stop();\n        }\n      }, _callee20);\n    }));\n    function setForUser(_x81, _x82, _x83) {\n      return _setForUser2.apply(this, arguments);\n    }\n    return setForUser;\n  }(),\n  deleteForUser: function () {\n    var _deleteForUser2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee21(userId, key, options) {\n      return _regeneratorRuntime().wrap(function _callee21$(_context21) {\n        while (1) switch (_context21.prev = _context21.next) {\n          case 0:\n          case \"end\":\n            return _context21.stop();\n        }\n      }, _callee21);\n    }));\n    function deleteForUser(_x84, _x85, _x86) {\n      return _deleteForUser2.apply(this, arguments);\n    }\n    return deleteForUser;\n  }(),\n  deleteAllUserData: function () {\n    var _deleteAllUserData2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee22(userId, options) {\n      return _regeneratorRuntime().wrap(function _callee22$(_context22) {\n        while (1) switch (_context22.prev = _context22.next) {\n          case 0:\n          case \"end\":\n            return _context22.stop();\n        }\n      }, _callee22);\n    }));\n    function deleteAllUserData(_x87, _x88) {\n      return _deleteAllUserData2.apply(this, arguments);\n    }\n    return deleteAllUserData;\n  }()\n};\nvar mockStorage = function mockStorage(stored) {\n  var store = stored;\n  return {\n    get: function () {\n      var _get4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee23(key) {\n        return _regeneratorRuntime().wrap(function _callee23$(_context23) {\n          while (1) switch (_context23.prev = _context23.next) {\n            case 0:\n              if (!(store[key] === undefined)) {\n                _context23.next = 2;\n                break;\n              }\n              return _context23.abrupt(\"return\", undefined);\n            case 2:\n              if (!(typeof store[key] === \"string\")) {\n                _context23.next = 4;\n                break;\n              }\n              return _context23.abrupt(\"return\", store[key]);\n            case 4:\n              return _context23.abrupt(\"return\", JSON.stringify(store[key]));\n            case 5:\n            case \"end\":\n              return _context23.stop();\n          }\n        }, _callee23);\n      }));\n      function get(_x89) {\n        return _get4.apply(this, arguments);\n      }\n      return get;\n    }(),\n    set: function () {\n      var _set4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee24(key, value) {\n        return _regeneratorRuntime().wrap(function _callee24$(_context24) {\n          while (1) switch (_context24.prev = _context24.next) {\n            case 0:\n              store[key] = value;\n            case 1:\n            case \"end\":\n              return _context24.stop();\n          }\n        }, _callee24);\n      }));\n      function set(_x90, _x91) {\n        return _set4.apply(this, arguments);\n      }\n      return set;\n    }(),\n    delete: function () {\n      var _delete5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee25(key) {\n        return _regeneratorRuntime().wrap(function _callee25$(_context25) {\n          while (1) switch (_context25.prev = _context25.next) {\n            case 0:\n              delete store[key];\n            case 1:\n            case \"end\":\n              return _context25.stop();\n          }\n        }, _callee25);\n      }));\n      function _delete(_x92) {\n        return _delete5.apply(this, arguments);\n      }\n      return _delete;\n    }()\n  };\n};\nvar mockStorageUtility = function mockStorageUtility(stored) {\n  var isSecure = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  if (isSecure) {\n    return new StorageUtility(mockStorage(stored), mockStorage({}));\n  }\n  return new StorageUtility(mockStorage({}), mockStorage(stored));\n};\nexport { AggregateHandler, ConfigurationError, DEFAULT_SCOPES, EVENTS, InMemoryStorage, InvalidResponseError, NotImplementedError, OidcProviderError, PREFERRED_SIGNING_ALG, REFRESH_BEFORE_EXPIRATION_SECONDS, SOLID_CLIENT_AUTHN_KEY_PREFIX, StorageUtility, StorageUtilityGetResponse, StorageUtilityMock, USER_SESSION_PREFIX, buildAuthenticatedFetch, createDpopHeader, determineSigningAlg, fetchJwks, generateDpopKeyPair, getSessionIdFromOauthState, getWebidFromTokenPayload, handleRegistration, isSupportedTokenType, loadOidcContextFromStorage, mockStorage, mockStorageUtility, saveSessionInfoToStorage };","map":{"version":3,"names":["fetch","Headers","jwtVerify","importJWK","exportJWK","SignJWT","generateKeyPair","v4","SOLID_CLIENT_AUTHN_KEY_PREFIX","PREFERRED_SIGNING_ALG","EVENTS","ERROR","LOGIN","LOGOUT","NEW_REFRESH_TOKEN","SESSION_EXPIRED","SESSION_EXTENDED","SESSION_RESTORED","TIMEOUT_SET","REFRESH_BEFORE_EXPIRATION_SECONDS","SCOPE_OPENID","SCOPE_OFFLINE","SCOPE_WEBID","DEFAULT_SCOPES","join","AggregateHandler","handleables","params","Promise","all","map","handleable","canHandle","canHandleList","i","length","getProperHandler","handler","handle","Error","constructor","name","param","JSON","stringify","err","toString","fetchJwks","jwksIri","issuerIri","jwksResponse","status","statusText","json","jwk","keys","message","getWebidFromTokenPayload","idToken","clientId","issuer","audience","verifiedPayload","payload","stack","webid","sub","URL","isSupportedTokenType","token","includes","USER_SESSION_PREFIX","isValidUrl","url","_a","determineSigningAlg","supported","preferred","find","signingAlg","determineClientType","options","issuerConfig","undefined","scopesSupported","handleRegistration","storageUtility","clientRegistrar","clientType","getClient","sessionId","clientName","redirectUrl","setForUser","clientSecret","getSessionIdFromOauthState","oauthState","getForUser","loadOidcContextFromStorage","configFetcher","errorIfNull","codeVerifier","storedRedirectIri","dpop","deleteForUser","fetchConfig","saveSessionInfoToStorage","webId","isLoggedIn","refreshToken","secure","dpopKey","publicKey","privateKey","StorageUtility","secureStorage","insecureStorage","userId","get","getKey","stored","parse","data","set","key","value","delete","getUserData","userData","values","setUserData","InMemoryStorage","ConfigurationError","NotImplementedError","methodName","InvalidResponseError","missingFields","OidcProviderError","error","errorDescription","normalizeHTU","audienceUrl","pathname","origin","createDpopHeader","method","htu","htm","toUpperCase","jti","setProtectedHeader","alg","typ","setIssuedAt","sign","generateDpopKeyPair","dpopKeyPair","DEFAULT_EXPIRATION_TIME_SECONDS","isExpectedAuthError","statusCode","buildDpopFetchOptions","targetUrl","authToken","defaultOptions","headers","buildAuthenticatedHeaders","makeAuthenticatedRequest","unauthFetch","accessToken","defaultRequestInit","refreshAccessToken","refreshOptions","eventEmitter","tokenRefresher","refresh","tokenSet","emit","expiresIn","computeRefreshDelay","buildAuthenticatedFetch","currentAccessToken","currentRefreshOptions","proactivelyRefreshToken","refreshedAccessToken","clearTimeout","latestTimeout","setTimeout","_b","_c","_d","expirationTimeout","requestInit","response","failedButNotExpectedAuthError","ok","hasBeenRedirected","StorageUtilityGetResponse","StorageUtilityMock","deleteAllUserData","mockStorage","store","mockStorageUtility","isSecure"],"sources":["E:/react-todo-app/node_modules/@inrupt/solid-client-authn-core/dist/index.mjs"],"sourcesContent":["import { fetch, Headers } from 'cross-fetch';\nimport { jwtVerify, importJWK, exportJWK, SignJWT, generateKeyPair } from 'jose';\nimport { v4 } from 'uuid';\n\nconst SOLID_CLIENT_AUTHN_KEY_PREFIX = \"solidClientAuthn:\";\r\nconst PREFERRED_SIGNING_ALG = [\"ES256\", \"RS256\"];\r\nconst EVENTS = {\r\n    ERROR: \"error\",\r\n    LOGIN: \"login\",\r\n    LOGOUT: \"logout\",\r\n    NEW_REFRESH_TOKEN: \"newRefreshToken\",\r\n    SESSION_EXPIRED: \"sessionExpired\",\r\n    SESSION_EXTENDED: \"sessionExtended\",\r\n    SESSION_RESTORED: \"sessionRestore\",\r\n    TIMEOUT_SET: \"timeoutSet\",\r\n};\r\nconst REFRESH_BEFORE_EXPIRATION_SECONDS = 5;\r\nconst SCOPE_OPENID = \"openid\";\r\nconst SCOPE_OFFLINE = \"offline_access\";\r\nconst SCOPE_WEBID = \"webid\";\r\nconst DEFAULT_SCOPES = [SCOPE_OPENID, SCOPE_OFFLINE, SCOPE_WEBID].join(\" \");\n\nclass AggregateHandler {\r\n    constructor(handleables) {\r\n        this.handleables = handleables;\r\n    }\r\n    async getProperHandler(params) {\r\n        const canHandleList = await Promise.all(this.handleables.map((handleable) => handleable.canHandle(...params)));\r\n        for (let i = 0; i < canHandleList.length; i += 1) {\r\n            if (canHandleList[i]) {\r\n                return this.handleables[i];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    async canHandle(...params) {\r\n        return (await this.getProperHandler(params)) !== null;\r\n    }\r\n    async handle(...params) {\r\n        const handler = await this.getProperHandler(params);\r\n        if (handler) {\r\n            return handler.handle(...params);\r\n        }\r\n        throw new Error(`[${this.constructor.name}] cannot find a suitable handler for: ${params\r\n            .map((param) => {\r\n            try {\r\n                return JSON.stringify(param);\r\n            }\r\n            catch (err) {\r\n                return param.toString();\r\n            }\r\n        })\r\n            .join(\", \")}`);\r\n    }\r\n}\n\nasync function fetchJwks(jwksIri, issuerIri) {\r\n    const jwksResponse = await fetch(jwksIri);\r\n    if (jwksResponse.status !== 200) {\r\n        throw new Error(`Could not fetch JWKS for [${issuerIri}] at [${jwksIri}]: ${jwksResponse.status} ${jwksResponse.statusText}`);\r\n    }\r\n    let jwk;\r\n    try {\r\n        jwk = (await jwksResponse.json()).keys[0];\r\n    }\r\n    catch (e) {\r\n        throw new Error(`Malformed JWKS for [${issuerIri}] at [${jwksIri}]: ${e.message}`);\r\n    }\r\n    return jwk;\r\n}\r\nasync function getWebidFromTokenPayload(idToken, jwksIri, issuerIri, clientId) {\r\n    const jwk = await fetchJwks(jwksIri, issuerIri);\r\n    let payload;\r\n    try {\r\n        const { payload: verifiedPayload } = await jwtVerify(idToken, await importJWK(jwk), {\r\n            issuer: issuerIri,\r\n            audience: clientId,\r\n        });\r\n        payload = verifiedPayload;\r\n    }\r\n    catch (e) {\r\n        throw new Error(`Token verification failed: ${e.stack}`);\r\n    }\r\n    if (typeof payload.webid === \"string\") {\r\n        return payload.webid;\r\n    }\r\n    if (typeof payload.sub !== \"string\") {\r\n        throw new Error(`The token ${JSON.stringify(payload)} is invalid: it has no 'webid' claim and no 'sub' claim.`);\r\n    }\r\n    try {\r\n        new URL(payload.sub);\r\n        return payload.sub;\r\n    }\r\n    catch (e) {\r\n        throw new Error(`The token has no 'webid' claim, and its 'sub' claim of [${payload.sub}] is invalid as a URL - error [${e}].`);\r\n    }\r\n}\n\nfunction isSupportedTokenType(token) {\r\n    return typeof token === \"string\" && [\"DPoP\", \"Bearer\"].includes(token);\r\n}\n\nconst USER_SESSION_PREFIX = \"solidClientAuthenticationUser\";\n\nfunction isValidUrl(url) {\r\n    try {\r\n        new URL(url);\r\n        return true;\r\n    }\r\n    catch (_a) {\r\n        return false;\r\n    }\r\n}\r\nfunction determineSigningAlg(supported, preferred) {\r\n    var _a;\r\n    return ((_a = preferred.find((signingAlg) => {\r\n        return supported.includes(signingAlg);\r\n    })) !== null && _a !== void 0 ? _a : null);\r\n}\r\nfunction determineClientType(options, issuerConfig) {\r\n    if (options.clientId !== undefined && !isValidUrl(options.clientId)) {\r\n        return \"static\";\r\n    }\r\n    if (issuerConfig.scopesSupported.includes(\"webid\") &&\r\n        options.clientId !== undefined &&\r\n        isValidUrl(options.clientId)) {\r\n        return \"solid-oidc\";\r\n    }\r\n    return \"dynamic\";\r\n}\r\nasync function handleRegistration(options, issuerConfig, storageUtility, clientRegistrar) {\r\n    const clientType = determineClientType(options, issuerConfig);\r\n    if (clientType === \"dynamic\") {\r\n        return clientRegistrar.getClient({\r\n            sessionId: options.sessionId,\r\n            clientName: options.clientName,\r\n            redirectUrl: options.redirectUrl,\r\n        }, issuerConfig);\r\n    }\r\n    await storageUtility.setForUser(options.sessionId, {\r\n        clientId: options.clientId,\r\n    });\r\n    if (options.clientSecret) {\r\n        await storageUtility.setForUser(options.sessionId, {\r\n            clientSecret: options.clientSecret,\r\n        });\r\n    }\r\n    if (options.clientName) {\r\n        await storageUtility.setForUser(options.sessionId, {\r\n            clientName: options.clientName,\r\n        });\r\n    }\r\n    return {\r\n        clientId: options.clientId,\r\n        clientSecret: options.clientSecret,\r\n        clientName: options.clientName,\r\n        clientType,\r\n    };\r\n}\n\nasync function getSessionIdFromOauthState(storageUtility, oauthState) {\r\n    return storageUtility.getForUser(oauthState, \"sessionId\");\r\n}\r\nasync function loadOidcContextFromStorage(sessionId, storageUtility, configFetcher) {\r\n    try {\r\n        const [issuerIri, codeVerifier, storedRedirectIri, dpop] = await Promise.all([\r\n            storageUtility.getForUser(sessionId, \"issuer\", {\r\n                errorIfNull: true,\r\n            }),\r\n            storageUtility.getForUser(sessionId, \"codeVerifier\"),\r\n            storageUtility.getForUser(sessionId, \"redirectUrl\"),\r\n            storageUtility.getForUser(sessionId, \"dpop\", { errorIfNull: true }),\r\n        ]);\r\n        await storageUtility.deleteForUser(sessionId, \"codeVerifier\");\r\n        const issuerConfig = await configFetcher.fetchConfig(issuerIri);\r\n        return {\r\n            codeVerifier,\r\n            redirectUrl: storedRedirectIri,\r\n            issuerConfig,\r\n            dpop: dpop === \"true\",\r\n        };\r\n    }\r\n    catch (e) {\r\n        throw new Error(`Failed to retrieve OIDC context from storage associated with session [${sessionId}]: ${e}`);\r\n    }\r\n}\r\nasync function saveSessionInfoToStorage(storageUtility, sessionId, webId, isLoggedIn, refreshToken, secure, dpopKey) {\r\n    if (refreshToken !== undefined) {\r\n        await storageUtility.setForUser(sessionId, { refreshToken }, { secure });\r\n    }\r\n    if (webId !== undefined) {\r\n        await storageUtility.setForUser(sessionId, { webId }, { secure });\r\n    }\r\n    if (isLoggedIn !== undefined) {\r\n        await storageUtility.setForUser(sessionId, { isLoggedIn }, { secure });\r\n    }\r\n    if (dpopKey !== undefined) {\r\n        await storageUtility.setForUser(sessionId, {\r\n            publicKey: JSON.stringify(dpopKey.publicKey),\r\n            privateKey: JSON.stringify(await exportJWK(dpopKey.privateKey)),\r\n        }, { secure });\r\n    }\r\n}\r\nclass StorageUtility {\r\n    constructor(secureStorage, insecureStorage) {\r\n        this.secureStorage = secureStorage;\r\n        this.insecureStorage = insecureStorage;\r\n    }\r\n    getKey(userId) {\r\n        return `solidClientAuthenticationUser:${userId}`;\r\n    }\r\n    async getUserData(userId, secure) {\r\n        const stored = await (secure\r\n            ? this.secureStorage\r\n            : this.insecureStorage).get(this.getKey(userId));\r\n        if (stored === undefined) {\r\n            return {};\r\n        }\r\n        try {\r\n            return JSON.parse(stored);\r\n        }\r\n        catch (err) {\r\n            throw new Error(`Data for user [${userId}] in [${secure ? \"secure\" : \"unsecure\"}] storage is corrupted - expected valid JSON, but got: ${stored}`);\r\n        }\r\n    }\r\n    async setUserData(userId, data, secure) {\r\n        await (secure ? this.secureStorage : this.insecureStorage).set(this.getKey(userId), JSON.stringify(data));\r\n    }\r\n    async get(key, options) {\r\n        const value = await ((options === null || options === void 0 ? void 0 : options.secure)\r\n            ? this.secureStorage\r\n            : this.insecureStorage).get(key);\r\n        if (value === undefined && (options === null || options === void 0 ? void 0 : options.errorIfNull)) {\r\n            throw new Error(`[${key}] is not stored`);\r\n        }\r\n        return value;\r\n    }\r\n    async set(key, value, options) {\r\n        return ((options === null || options === void 0 ? void 0 : options.secure) ? this.secureStorage : this.insecureStorage).set(key, value);\r\n    }\r\n    async delete(key, options) {\r\n        return ((options === null || options === void 0 ? void 0 : options.secure) ? this.secureStorage : this.insecureStorage).delete(key);\r\n    }\r\n    async getForUser(userId, key, options) {\r\n        const userData = await this.getUserData(userId, options === null || options === void 0 ? void 0 : options.secure);\r\n        let value;\r\n        if (!userData || !userData[key]) {\r\n            value = undefined;\r\n        }\r\n        value = userData[key];\r\n        if (value === undefined && (options === null || options === void 0 ? void 0 : options.errorIfNull)) {\r\n            throw new Error(`Field [${key}] for user [${userId}] is not stored`);\r\n        }\r\n        return value || undefined;\r\n    }\r\n    async setForUser(userId, values, options) {\r\n        let userData;\r\n        try {\r\n            userData = await this.getUserData(userId, options === null || options === void 0 ? void 0 : options.secure);\r\n        }\r\n        catch (_a) {\r\n            userData = {};\r\n        }\r\n        await this.setUserData(userId, { ...userData, ...values }, options === null || options === void 0 ? void 0 : options.secure);\r\n    }\r\n    async deleteForUser(userId, key, options) {\r\n        const userData = await this.getUserData(userId, options === null || options === void 0 ? void 0 : options.secure);\r\n        delete userData[key];\r\n        await this.setUserData(userId, userData, options === null || options === void 0 ? void 0 : options.secure);\r\n    }\r\n    async deleteAllUserData(userId, options) {\r\n        await ((options === null || options === void 0 ? void 0 : options.secure) ? this.secureStorage : this.insecureStorage).delete(this.getKey(userId));\r\n    }\r\n}\n\nclass InMemoryStorage {\r\n    constructor() {\r\n        this.map = {};\r\n    }\r\n    async get(key) {\r\n        return this.map[key] || undefined;\r\n    }\r\n    async set(key, value) {\r\n        this.map[key] = value;\r\n    }\r\n    async delete(key) {\r\n        delete this.map[key];\r\n    }\r\n}\n\nclass ConfigurationError extends Error {\r\n    constructor(message) {\r\n        super(message);\r\n    }\r\n}\n\nclass NotImplementedError extends Error {\r\n    constructor(methodName) {\r\n        super(`[${methodName}] is not implemented`);\r\n    }\r\n}\n\nclass InvalidResponseError extends Error {\r\n    constructor(missingFields) {\r\n        super(`Invalid response from OIDC provider: missing fields ${missingFields}`);\r\n        this.missingFields = missingFields;\r\n    }\r\n}\n\nclass OidcProviderError extends Error {\r\n    constructor(message, error, errorDescription) {\r\n        super(message);\r\n        this.error = error;\r\n        this.errorDescription = errorDescription;\r\n    }\r\n}\n\nfunction normalizeHTU(audience) {\r\n    const audienceUrl = new URL(audience);\r\n    return new URL(audienceUrl.pathname, audienceUrl.origin).toString();\r\n}\r\nasync function createDpopHeader(audience, method, dpopKey) {\r\n    return new SignJWT({\r\n        htu: normalizeHTU(audience),\r\n        htm: method.toUpperCase(),\r\n        jti: v4(),\r\n    })\r\n        .setProtectedHeader({\r\n        alg: PREFERRED_SIGNING_ALG[0],\r\n        jwk: dpopKey.publicKey,\r\n        typ: \"dpop+jwt\",\r\n    })\r\n        .setIssuedAt()\r\n        .sign(dpopKey.privateKey, {});\r\n}\r\nasync function generateDpopKeyPair() {\r\n    const { privateKey, publicKey } = await generateKeyPair(PREFERRED_SIGNING_ALG[0]);\r\n    const dpopKeyPair = {\r\n        privateKey,\r\n        publicKey: await exportJWK(publicKey),\r\n    };\r\n    [dpopKeyPair.publicKey.alg] = PREFERRED_SIGNING_ALG;\r\n    return dpopKeyPair;\r\n}\n\nconst DEFAULT_EXPIRATION_TIME_SECONDS = 600;\r\nfunction isExpectedAuthError(statusCode) {\r\n    return [401, 403].includes(statusCode);\r\n}\r\nasync function buildDpopFetchOptions(targetUrl, authToken, dpopKey, defaultOptions) {\r\n    var _a;\r\n    const headers = new Headers(defaultOptions === null || defaultOptions === void 0 ? void 0 : defaultOptions.headers);\r\n    headers.set(\"Authorization\", `DPoP ${authToken}`);\r\n    headers.set(\"DPoP\", await createDpopHeader(targetUrl, (_a = defaultOptions === null || defaultOptions === void 0 ? void 0 : defaultOptions.method) !== null && _a !== void 0 ? _a : \"get\", dpopKey));\r\n    return {\r\n        ...defaultOptions,\r\n        headers,\r\n    };\r\n}\r\nasync function buildAuthenticatedHeaders(targetUrl, authToken, dpopKey, defaultOptions) {\r\n    if (dpopKey !== undefined) {\r\n        return buildDpopFetchOptions(targetUrl, authToken, dpopKey, defaultOptions);\r\n    }\r\n    const headers = new Headers(defaultOptions === null || defaultOptions === void 0 ? void 0 : defaultOptions.headers);\r\n    headers.set(\"Authorization\", `Bearer ${authToken}`);\r\n    return {\r\n        ...defaultOptions,\r\n        headers,\r\n    };\r\n}\r\nasync function makeAuthenticatedRequest(unauthFetch, accessToken, url, defaultRequestInit, dpopKey) {\r\n    return unauthFetch(url, await buildAuthenticatedHeaders(url.toString(), accessToken, dpopKey, defaultRequestInit));\r\n}\r\nasync function refreshAccessToken(refreshOptions, dpopKey, eventEmitter) {\r\n    var _a;\r\n    const tokenSet = await refreshOptions.tokenRefresher.refresh(refreshOptions.sessionId, refreshOptions.refreshToken, dpopKey);\r\n    eventEmitter === null || eventEmitter === void 0 ? void 0 : eventEmitter.emit(EVENTS.SESSION_EXTENDED, (_a = tokenSet.expiresIn) !== null && _a !== void 0 ? _a : DEFAULT_EXPIRATION_TIME_SECONDS);\r\n    if (typeof tokenSet.refreshToken === \"string\") {\r\n        eventEmitter === null || eventEmitter === void 0 ? void 0 : eventEmitter.emit(EVENTS.NEW_REFRESH_TOKEN, tokenSet.refreshToken);\r\n    }\r\n    return {\r\n        accessToken: tokenSet.accessToken,\r\n        refreshToken: tokenSet.refreshToken,\r\n        expiresIn: tokenSet.expiresIn,\r\n    };\r\n}\r\nconst computeRefreshDelay = (expiresIn) => {\r\n    if (expiresIn !== undefined) {\r\n        return expiresIn - REFRESH_BEFORE_EXPIRATION_SECONDS > 0\r\n            ?\r\n                expiresIn - REFRESH_BEFORE_EXPIRATION_SECONDS\r\n            : expiresIn;\r\n    }\r\n    return DEFAULT_EXPIRATION_TIME_SECONDS;\r\n};\r\nasync function buildAuthenticatedFetch(unauthFetch, accessToken, options) {\r\n    var _a;\r\n    let currentAccessToken = accessToken;\r\n    let latestTimeout;\r\n    const currentRefreshOptions = options === null || options === void 0 ? void 0 : options.refreshOptions;\r\n    if (currentRefreshOptions !== undefined) {\r\n        const proactivelyRefreshToken = async () => {\r\n            var _a, _b, _c, _d;\r\n            try {\r\n                const { accessToken: refreshedAccessToken, refreshToken, expiresIn, } = await refreshAccessToken(currentRefreshOptions, options.dpopKey, options.eventEmitter);\r\n                currentAccessToken = refreshedAccessToken;\r\n                if (refreshToken !== undefined) {\r\n                    currentRefreshOptions.refreshToken = refreshToken;\r\n                }\r\n                clearTimeout(latestTimeout);\r\n                latestTimeout = setTimeout(proactivelyRefreshToken, computeRefreshDelay(expiresIn) * 1000);\r\n                (_a = options.eventEmitter) === null || _a === void 0 ? void 0 : _a.emit(EVENTS.TIMEOUT_SET, latestTimeout);\r\n            }\r\n            catch (e) {\r\n                if (e instanceof OidcProviderError) {\r\n                    (_b = options === null || options === void 0 ? void 0 : options.eventEmitter) === null || _b === void 0 ? void 0 : _b.emit(EVENTS.ERROR, e.error, e.errorDescription);\r\n                    (_c = options === null || options === void 0 ? void 0 : options.eventEmitter) === null || _c === void 0 ? void 0 : _c.emit(EVENTS.SESSION_EXPIRED);\r\n                }\r\n                if (e instanceof InvalidResponseError &&\r\n                    e.missingFields.includes(\"access_token\")) {\r\n                    (_d = options === null || options === void 0 ? void 0 : options.eventEmitter) === null || _d === void 0 ? void 0 : _d.emit(EVENTS.SESSION_EXPIRED);\r\n                }\r\n            }\r\n        };\r\n        latestTimeout = setTimeout(proactivelyRefreshToken, computeRefreshDelay(options.expiresIn) * 1000);\r\n        (_a = options.eventEmitter) === null || _a === void 0 ? void 0 : _a.emit(EVENTS.TIMEOUT_SET, latestTimeout);\r\n    }\r\n    else if (options !== undefined && options.eventEmitter !== undefined) {\r\n        const expirationTimeout = setTimeout(() => {\r\n            options.eventEmitter.emit(EVENTS.SESSION_EXPIRED);\r\n        }, computeRefreshDelay(options.expiresIn) * 1000);\r\n        options.eventEmitter.emit(EVENTS.TIMEOUT_SET, expirationTimeout);\r\n    }\r\n    return async (url, requestInit) => {\r\n        let response = await makeAuthenticatedRequest(unauthFetch, currentAccessToken, url, requestInit, options === null || options === void 0 ? void 0 : options.dpopKey);\r\n        const failedButNotExpectedAuthError = !response.ok && !isExpectedAuthError(response.status);\r\n        if (response.ok || failedButNotExpectedAuthError) {\r\n            return response;\r\n        }\r\n        const hasBeenRedirected = response.url !== url;\r\n        if (hasBeenRedirected && (options === null || options === void 0 ? void 0 : options.dpopKey) !== undefined) {\r\n            response = await makeAuthenticatedRequest(unauthFetch, currentAccessToken, response.url, requestInit, options.dpopKey);\r\n        }\r\n        return response;\r\n    };\r\n}\n\nconst StorageUtilityGetResponse = \"getResponse\";\r\nconst StorageUtilityMock = {\r\n    get: async (key, options) => StorageUtilityGetResponse,\r\n    set: async (key, value) => {\r\n    },\r\n    delete: async (key) => {\r\n    },\r\n    getForUser: async (userId, key, options) => StorageUtilityGetResponse,\r\n    setForUser: async (userId, values, options) => {\r\n    },\r\n    deleteForUser: async (userId, key, options) => {\r\n    },\r\n    deleteAllUserData: async (userId, options) => {\r\n    },\r\n};\r\nconst mockStorage = (stored) => {\r\n    const store = stored;\r\n    return {\r\n        get: async (key) => {\r\n            if (store[key] === undefined) {\r\n                return undefined;\r\n            }\r\n            if (typeof store[key] === \"string\") {\r\n                return store[key];\r\n            }\r\n            return JSON.stringify(store[key]);\r\n        },\r\n        set: async (key, value) => {\r\n            store[key] = value;\r\n        },\r\n        delete: async (key) => {\r\n            delete store[key];\r\n        },\r\n    };\r\n};\r\nconst mockStorageUtility = (stored, isSecure = false) => {\r\n    if (isSecure) {\r\n        return new StorageUtility(mockStorage(stored), mockStorage({}));\r\n    }\r\n    return new StorageUtility(mockStorage({}), mockStorage(stored));\r\n};\n\nexport { AggregateHandler, ConfigurationError, DEFAULT_SCOPES, EVENTS, InMemoryStorage, InvalidResponseError, NotImplementedError, OidcProviderError, PREFERRED_SIGNING_ALG, REFRESH_BEFORE_EXPIRATION_SECONDS, SOLID_CLIENT_AUTHN_KEY_PREFIX, StorageUtility, StorageUtilityGetResponse, StorageUtilityMock, USER_SESSION_PREFIX, buildAuthenticatedFetch, createDpopHeader, determineSigningAlg, fetchJwks, generateDpopKeyPair, getSessionIdFromOauthState, getWebidFromTokenPayload, handleRegistration, isSupportedTokenType, loadOidcContextFromStorage, mockStorage, mockStorageUtility, saveSessionInfoToStorage };\n"],"mappings":";;;;;;;;;;AAAA,SAASA,KAAK,EAAEC,OAAO,QAAQ,aAAa;AAC5C,SAASC,SAAS,EAAEC,SAAS,EAAEC,SAAS,EAAEC,OAAO,EAAEC,eAAe,QAAQ,MAAM;AAChF,SAASC,EAAE,QAAQ,MAAM;AAEzB,IAAMC,6BAA6B,GAAG,mBAAmB;AACzD,IAAMC,qBAAqB,GAAG,CAAC,OAAO,EAAE,OAAO,CAAC;AAChD,IAAMC,MAAM,GAAG;EACXC,KAAK,EAAE,OAAO;EACdC,KAAK,EAAE,OAAO;EACdC,MAAM,EAAE,QAAQ;EAChBC,iBAAiB,EAAE,iBAAiB;EACpCC,eAAe,EAAE,gBAAgB;EACjCC,gBAAgB,EAAE,iBAAiB;EACnCC,gBAAgB,EAAE,gBAAgB;EAClCC,WAAW,EAAE;AACjB,CAAC;AACD,IAAMC,iCAAiC,GAAG,CAAC;AAC3C,IAAMC,YAAY,GAAG,QAAQ;AAC7B,IAAMC,aAAa,GAAG,gBAAgB;AACtC,IAAMC,WAAW,GAAG,OAAO;AAC3B,IAAMC,cAAc,GAAG,CAACH,YAAY,EAAEC,aAAa,EAAEC,WAAW,CAAC,CAACE,IAAI,CAAC,GAAG,CAAC;AAAC,IAEtEC,gBAAgB;EAClB,0BAAYC,WAAW,EAAE;IAAA;IACrB,IAAI,CAACA,WAAW,GAAGA,WAAW;EAClC;EAAC;IAAA;IAAA;MAAA,mFACD,iBAAuBC,MAAM;QAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACGC,OAAO,CAACC,GAAG,CAAC,IAAI,CAACH,WAAW,CAACI,GAAG,CAAC,UAACC,UAAU;gBAAA,OAAKA,UAAU,CAACC,SAAS,OAApBD,UAAU,qBAAcJ,MAAM,EAAC;cAAA,EAAC,CAAC;YAAA;cAAxGM,aAAa;cACVC,CAAC,GAAG,CAAC;YAAA;cAAA,MAAEA,CAAC,GAAGD,aAAa,CAACE,MAAM;gBAAA;gBAAA;cAAA;cAAA,KAChCF,aAAa,CAACC,CAAC,CAAC;gBAAA;gBAAA;cAAA;cAAA,iCACT,IAAI,CAACR,WAAW,CAACQ,CAAC,CAAC;YAAA;cAFQA,CAAC,IAAI,CAAC;cAAA;cAAA;YAAA;cAAA,iCAKzC,IAAI;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA,CACd;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;IAAA;IAAA;MAAA,4EACD;QAAA;UAAA;UAAA;UAAA;QAAA;UAAA;YAAA;cAAA,2BAAmBP,MAAM;gBAANA,MAAM;cAAA;cAAA;cAAA,OACP,IAAI,CAACS,gBAAgB,CAACT,MAAM,CAAC;YAAA;cAAA;cAAA,mDAAM,IAAI;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA,CACxD;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;IAAA;IAAA;MAAA,yEACD;QAAA;UAAA;UAAA;UAAA;UAAA;QAAA;UAAA;YAAA;cAAA,4BAAgBA,MAAM;gBAANA,MAAM;cAAA;cAAA;cAAA,OACI,IAAI,CAACS,gBAAgB,CAACT,MAAM,CAAC;YAAA;cAA7CU,OAAO;cAAA,KACTA,OAAO;gBAAA;gBAAA;cAAA;cAAA,kCACAA,OAAO,CAACC,MAAM,OAAdD,OAAO,EAAWV,MAAM,CAAC;YAAA;cAAA,MAE9B,IAAIY,KAAK,YAAK,IAAI,CAACC,WAAW,CAACC,IAAI,mDAAyCd,MAAM,CACnFG,GAAG,CAAC,UAACY,KAAK,EAAK;gBAChB,IAAI;kBACA,OAAOC,IAAI,CAACC,SAAS,CAACF,KAAK,CAAC;gBAChC,CAAC,CACD,OAAOG,GAAG,EAAE;kBACR,OAAOH,KAAK,CAACI,QAAQ,EAAE;gBAC3B;cACJ,CAAC,CAAC,CACGtB,IAAI,CAAC,IAAI,CAAC,EAAG;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA,CACrB;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;EAAA;AAAA;AAAA,SAGUuB,SAAS;EAAA;AAAA;AAAA;EAAA,wEAAxB,mBAAyBC,OAAO,EAAEC,SAAS;IAAA;IAAA;MAAA;QAAA;UAAA;UAAA,OACZjD,KAAK,CAACgD,OAAO,CAAC;QAAA;UAAnCE,YAAY;UAAA,MACdA,YAAY,CAACC,MAAM,KAAK,GAAG;YAAA;YAAA;UAAA;UAAA,MACrB,IAAIZ,KAAK,qCAA8BU,SAAS,mBAASD,OAAO,gBAAME,YAAY,CAACC,MAAM,cAAID,YAAY,CAACE,UAAU,EAAG;QAAA;UAAA;UAAA;UAAA,OAIhHF,YAAY,CAACG,IAAI,EAAE;QAAA;UAAhCC,GAAG,mBAA+BC,IAAI,CAAC,CAAC;UAAA;UAAA;QAAA;UAAA;UAAA;UAAA,MAGlC,IAAIhB,KAAK,+BAAwBU,SAAS,mBAASD,OAAO,gBAAM,cAAEQ,OAAO,EAAG;QAAA;UAAA,mCAE/EF,GAAG;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CACb;EAAA;AAAA;AAAA,SACcG,wBAAwB;EAAA;AAAA;AAAA;EAAA,uFAAvC,mBAAwCC,OAAO,EAAEV,OAAO,EAAEC,SAAS,EAAEU,QAAQ;IAAA;IAAA;MAAA;QAAA;UAAA;UAAA,OACvDZ,SAAS,CAACC,OAAO,EAAEC,SAAS,CAAC;QAAA;UAAzCK,GAAG;UAAA;UAAA,gBAGsCpD,SAAS;UAAA,gBAACwD,OAAO;UAAA;UAAA,OAAQvD,SAAS,CAACmD,GAAG,CAAC;QAAA;UAAA;UAAA,gBAAE;YAChFM,MAAM,EAAEX,SAAS;YACjBY,QAAQ,EAAEF;UACd,CAAC;UAAA;UAAA;QAAA;UAAA;UAHgBG,eAAe,oBAAxBC,OAAO;UAIfA,OAAO,GAAGD,eAAe;UAAC;UAAA;QAAA;UAAA;UAAA;UAAA,MAGpB,IAAIvB,KAAK,sCAA+B,cAAEyB,KAAK,EAAG;QAAA;UAAA,MAExD,OAAOD,OAAO,CAACE,KAAK,KAAK,QAAQ;YAAA;YAAA;UAAA;UAAA,mCAC1BF,OAAO,CAACE,KAAK;QAAA;UAAA,MAEpB,OAAOF,OAAO,CAACG,GAAG,KAAK,QAAQ;YAAA;YAAA;UAAA;UAAA,MACzB,IAAI3B,KAAK,qBAAcI,IAAI,CAACC,SAAS,CAACmB,OAAO,CAAC,8DAA2D;QAAA;UAAA;UAG/G,IAAII,GAAG,CAACJ,OAAO,CAACG,GAAG,CAAC;UAAC,mCACdH,OAAO,CAACG,GAAG;QAAA;UAAA;UAAA;UAAA,MAGZ,IAAI3B,KAAK,mEAA4DwB,OAAO,CAACG,GAAG,iEAAwC;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CAErI;EAAA;AAAA;AAED,SAASE,oBAAoB,CAACC,KAAK,EAAE;EACjC,OAAO,OAAOA,KAAK,KAAK,QAAQ,IAAI,CAAC,MAAM,EAAE,QAAQ,CAAC,CAACC,QAAQ,CAACD,KAAK,CAAC;AAC1E;AAEA,IAAME,mBAAmB,GAAG,+BAA+B;AAE3D,SAASC,UAAU,CAACC,GAAG,EAAE;EACrB,IAAI;IACA,IAAIN,GAAG,CAACM,GAAG,CAAC;IACZ,OAAO,IAAI;EACf,CAAC,CACD,OAAOC,EAAE,EAAE;IACP,OAAO,KAAK;EAChB;AACJ;AACA,SAASC,mBAAmB,CAACC,SAAS,EAAEC,SAAS,EAAE;EAC/C,IAAIH,EAAE;EACN,OAAQ,CAACA,EAAE,GAAGG,SAAS,CAACC,IAAI,CAAC,UAACC,UAAU,EAAK;IACzC,OAAOH,SAAS,CAACN,QAAQ,CAACS,UAAU,CAAC;EACzC,CAAC,CAAC,MAAM,IAAI,IAAIL,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,IAAI;AAC7C;AACA,SAASM,mBAAmB,CAACC,OAAO,EAAEC,YAAY,EAAE;EAChD,IAAID,OAAO,CAACtB,QAAQ,KAAKwB,SAAS,IAAI,CAACX,UAAU,CAACS,OAAO,CAACtB,QAAQ,CAAC,EAAE;IACjE,OAAO,QAAQ;EACnB;EACA,IAAIuB,YAAY,CAACE,eAAe,CAACd,QAAQ,CAAC,OAAO,CAAC,IAC9CW,OAAO,CAACtB,QAAQ,KAAKwB,SAAS,IAC9BX,UAAU,CAACS,OAAO,CAACtB,QAAQ,CAAC,EAAE;IAC9B,OAAO,YAAY;EACvB;EACA,OAAO,SAAS;AACpB;AAAC,SACc0B,kBAAkB;EAAA;AAAA;AAAA;EAAA,iFAAjC,mBAAkCJ,OAAO,EAAEC,YAAY,EAAEI,cAAc,EAAEC,eAAe;IAAA;IAAA;MAAA;QAAA;UAC9EC,UAAU,GAAGR,mBAAmB,CAACC,OAAO,EAAEC,YAAY,CAAC;UAAA,MACzDM,UAAU,KAAK,SAAS;YAAA;YAAA;UAAA;UAAA,mCACjBD,eAAe,CAACE,SAAS,CAAC;YAC7BC,SAAS,EAAET,OAAO,CAACS,SAAS;YAC5BC,UAAU,EAAEV,OAAO,CAACU,UAAU;YAC9BC,WAAW,EAAEX,OAAO,CAACW;UACzB,CAAC,EAAEV,YAAY,CAAC;QAAA;UAAA;UAAA,OAEdI,cAAc,CAACO,UAAU,CAACZ,OAAO,CAACS,SAAS,EAAE;YAC/C/B,QAAQ,EAAEsB,OAAO,CAACtB;UACtB,CAAC,CAAC;QAAA;UAAA,KACEsB,OAAO,CAACa,YAAY;YAAA;YAAA;UAAA;UAAA;UAAA,OACdR,cAAc,CAACO,UAAU,CAACZ,OAAO,CAACS,SAAS,EAAE;YAC/CI,YAAY,EAAEb,OAAO,CAACa;UAC1B,CAAC,CAAC;QAAA;UAAA,KAEFb,OAAO,CAACU,UAAU;YAAA;YAAA;UAAA;UAAA;UAAA,OACZL,cAAc,CAACO,UAAU,CAACZ,OAAO,CAACS,SAAS,EAAE;YAC/CC,UAAU,EAAEV,OAAO,CAACU;UACxB,CAAC,CAAC;QAAA;UAAA,mCAEC;YACHhC,QAAQ,EAAEsB,OAAO,CAACtB,QAAQ;YAC1BmC,YAAY,EAAEb,OAAO,CAACa,YAAY;YAClCH,UAAU,EAAEV,OAAO,CAACU,UAAU;YAC9BH,UAAU,EAAVA;UACJ,CAAC;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CACJ;EAAA;AAAA;AAAA,SAEcO,0BAA0B;EAAA;AAAA;AAAA;EAAA,yFAAzC,mBAA0CT,cAAc,EAAEU,UAAU;IAAA;MAAA;QAAA;UAAA,mCACzDV,cAAc,CAACW,UAAU,CAACD,UAAU,EAAE,WAAW,CAAC;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CAC5D;EAAA;AAAA;AAAA,SACcE,0BAA0B;EAAA;AAAA;AAAA;EAAA,yFAAzC,mBAA0CR,SAAS,EAAEJ,cAAc,EAAEa,aAAa;IAAA;IAAA;MAAA;QAAA;UAAA;UAAA;UAAA,OAETvE,OAAO,CAACC,GAAG,CAAC,CACzEyD,cAAc,CAACW,UAAU,CAACP,SAAS,EAAE,QAAQ,EAAE;YAC3CU,WAAW,EAAE;UACjB,CAAC,CAAC,EACFd,cAAc,CAACW,UAAU,CAACP,SAAS,EAAE,cAAc,CAAC,EACpDJ,cAAc,CAACW,UAAU,CAACP,SAAS,EAAE,aAAa,CAAC,EACnDJ,cAAc,CAACW,UAAU,CAACP,SAAS,EAAE,MAAM,EAAE;YAAEU,WAAW,EAAE;UAAK,CAAC,CAAC,CACtE,CAAC;QAAA;UAAA;UAAA;UAPKnD,SAAS;UAAEoD,YAAY;UAAEC,iBAAiB;UAAEC,IAAI;UAAA;UAAA,OAQjDjB,cAAc,CAACkB,aAAa,CAACd,SAAS,EAAE,cAAc,CAAC;QAAA;UAAA;UAAA,OAClCS,aAAa,CAACM,WAAW,CAACxD,SAAS,CAAC;QAAA;UAAzDiC,YAAY;UAAA,mCACX;YACHmB,YAAY,EAAZA,YAAY;YACZT,WAAW,EAAEU,iBAAiB;YAC9BpB,YAAY,EAAZA,YAAY;YACZqB,IAAI,EAAEA,IAAI,KAAK;UACnB,CAAC;QAAA;UAAA;UAAA;UAAA,MAGK,IAAIhE,KAAK,iFAA0EmD,SAAS,+BAAU;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CAEnH;EAAA;AAAA;AAAA,SACcgB,wBAAwB;EAAA;AAAA;AAAA;EAAA,uFAAvC,mBAAwCpB,cAAc,EAAEI,SAAS,EAAEiB,KAAK,EAAEC,UAAU,EAAEC,YAAY,EAAEC,MAAM,EAAEC,OAAO;IAAA;MAAA;QAAA;UAAA,MAC3GF,YAAY,KAAK1B,SAAS;YAAA;YAAA;UAAA;UAAA;UAAA,OACpBG,cAAc,CAACO,UAAU,CAACH,SAAS,EAAE;YAAEmB,YAAY,EAAZA;UAAa,CAAC,EAAE;YAAEC,MAAM,EAANA;UAAO,CAAC,CAAC;QAAA;UAAA,MAExEH,KAAK,KAAKxB,SAAS;YAAA;YAAA;UAAA;UAAA;UAAA,OACbG,cAAc,CAACO,UAAU,CAACH,SAAS,EAAE;YAAEiB,KAAK,EAALA;UAAM,CAAC,EAAE;YAAEG,MAAM,EAANA;UAAO,CAAC,CAAC;QAAA;UAAA,MAEjEF,UAAU,KAAKzB,SAAS;YAAA;YAAA;UAAA;UAAA;UAAA,OAClBG,cAAc,CAACO,UAAU,CAACH,SAAS,EAAE;YAAEkB,UAAU,EAAVA;UAAW,CAAC,EAAE;YAAEE,MAAM,EAANA;UAAO,CAAC,CAAC;QAAA;UAAA,MAEtEC,OAAO,KAAK5B,SAAS;YAAA;YAAA;UAAA;UAAA,gBACfG,cAAc;UAAA,gBAAYI,SAAS;UAAA,gBAC1B/C,IAAI,CAACC,SAAS,CAACmE,OAAO,CAACC,SAAS,CAAC;UAAA,gBAChCrE,IAAI;UAAA;UAAA,OAAiBvC,SAAS,CAAC2G,OAAO,CAACE,UAAU,CAAC;QAAA;UAAA;UAAA,8BAA7CrE,SAAS;UAAA;YAD1BoE,SAAS;YACTC,UAAU;UAAA;UAAA,gBACX;YAAEH,MAAM,EAANA;UAAO,CAAC;UAAA;UAAA,qBAHQjB,UAAU;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CAKtC;EAAA;AAAA;AAAA,IACKqB,cAAc;EAChB,wBAAYC,aAAa,EAAEC,eAAe,EAAE;IAAA;IACxC,IAAI,CAACD,aAAa,GAAGA,aAAa;IAClC,IAAI,CAACC,eAAe,GAAGA,eAAe;EAC1C;EAAC;IAAA;IAAA,OACD,gBAAOC,MAAM,EAAE;MACX,+CAAwCA,MAAM;IAClD;EAAC;IAAA;IAAA;MAAA,8EACD,kBAAkBA,MAAM,EAAEP,MAAM;QAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACP,CAACA,MAAM,GACtB,IAAI,CAACK,aAAa,GAClB,IAAI,CAACC,eAAe,EAAEE,GAAG,CAAC,IAAI,CAACC,MAAM,CAACF,MAAM,CAAC,CAAC;YAAA;cAF9CG,MAAM;cAAA,MAGRA,MAAM,KAAKrC,SAAS;gBAAA;gBAAA;cAAA;cAAA,kCACb,CAAC,CAAC;YAAA;cAAA;cAAA,kCAGFxC,IAAI,CAAC8E,KAAK,CAACD,MAAM,CAAC;YAAA;cAAA;cAAA;cAAA,MAGnB,IAAIjF,KAAK,0BAAmB8E,MAAM,mBAASP,MAAM,GAAG,QAAQ,GAAG,UAAU,oEAA0DU,MAAM,EAAG;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA,CAEzJ;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;IAAA;IAAA;MAAA,8EACD,kBAAkBH,MAAM,EAAEK,IAAI,EAAEZ,MAAM;QAAA;UAAA;YAAA;cAAA;cAAA,OAC5B,CAACA,MAAM,GAAG,IAAI,CAACK,aAAa,GAAG,IAAI,CAACC,eAAe,EAAEO,GAAG,CAAC,IAAI,CAACJ,MAAM,CAACF,MAAM,CAAC,EAAE1E,IAAI,CAACC,SAAS,CAAC8E,IAAI,CAAC,CAAC;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA,CAC5G;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;IAAA;IAAA;MAAA,sEACD,kBAAUE,GAAG,EAAE3C,OAAO;QAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACE,CAAC,CAACA,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC6B,MAAM,IAChF,IAAI,CAACK,aAAa,GAClB,IAAI,CAACC,eAAe,EAAEE,GAAG,CAACM,GAAG,CAAC;YAAA;cAF9BC,KAAK;cAAA,MAGPA,KAAK,KAAK1C,SAAS,KAAKF,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAACmB,WAAW,CAAC;gBAAA;gBAAA;cAAA;cAAA,MACxF,IAAI7D,KAAK,YAAKqF,GAAG,qBAAkB;YAAA;cAAA,kCAEtCC,KAAK;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA,CACf;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;IAAA;IAAA;MAAA,sEACD,kBAAUD,GAAG,EAAEC,KAAK,EAAE5C,OAAO;QAAA;UAAA;YAAA;cAAA,kCAClB,CAAC,CAACA,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC6B,MAAM,IAAI,IAAI,CAACK,aAAa,GAAG,IAAI,CAACC,eAAe,EAAEO,GAAG,CAACC,GAAG,EAAEC,KAAK,CAAC;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA,CAC1I;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;IAAA;IAAA;MAAA,0EACD,kBAAaD,GAAG,EAAE3C,OAAO;QAAA;UAAA;YAAA;cAAA,kCACd,CAAC,CAACA,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC6B,MAAM,IAAI,IAAI,CAACK,aAAa,GAAG,IAAI,CAACC,eAAe,EAAEU,MAAM,CAACF,GAAG,CAAC;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA,CACtI;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;IAAA;IAAA;MAAA,6EACD,kBAAiBP,MAAM,EAAEO,GAAG,EAAE3C,OAAO;QAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACV,IAAI,CAAC8C,WAAW,CAACV,MAAM,EAAEpC,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC6B,MAAM,CAAC;YAAA;cAA3GkB,QAAQ;cAEd,IAAI,CAACA,QAAQ,IAAI,CAACA,QAAQ,CAACJ,GAAG,CAAC,EAAE;gBAC7BC,KAAK,GAAG1C,SAAS;cACrB;cACA0C,KAAK,GAAGG,QAAQ,CAACJ,GAAG,CAAC;cAAC,MAClBC,KAAK,KAAK1C,SAAS,KAAKF,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAACmB,WAAW,CAAC;gBAAA;gBAAA;cAAA;cAAA,MACxF,IAAI7D,KAAK,kBAAWqF,GAAG,yBAAeP,MAAM,qBAAkB;YAAA;cAAA,kCAEjEQ,KAAK,IAAI1C,SAAS;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA,CAC5B;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;IAAA;IAAA;MAAA,6EACD,mBAAiBkC,MAAM,EAAEY,MAAM,EAAEhD,OAAO;QAAA;QAAA;UAAA;YAAA;cAAA;cAAA;cAAA,OAGf,IAAI,CAAC8C,WAAW,CAACV,MAAM,EAAEpC,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC6B,MAAM,CAAC;YAAA;cAA3GkB,QAAQ;cAAA;cAAA;YAAA;cAAA;cAAA;cAGRA,QAAQ,GAAG,CAAC,CAAC;YAAC;cAAA;cAAA,OAEZ,IAAI,CAACE,WAAW,CAACb,MAAM,kCAAOW,QAAQ,GAAKC,MAAM,GAAIhD,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC6B,MAAM,CAAC;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA,CAC/H;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;IAAA;IAAA;MAAA,gFACD,mBAAoBO,MAAM,EAAEO,GAAG,EAAE3C,OAAO;QAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACb,IAAI,CAAC8C,WAAW,CAACV,MAAM,EAAEpC,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC6B,MAAM,CAAC;YAAA;cAA3GkB,QAAQ;cACd,OAAOA,QAAQ,CAACJ,GAAG,CAAC;cAAC;cAAA,OACf,IAAI,CAACM,WAAW,CAACb,MAAM,EAAEW,QAAQ,EAAE/C,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC6B,MAAM,CAAC;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA,CAC7G;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;IAAA;IAAA;MAAA,oFACD,mBAAwBO,MAAM,EAAEpC,OAAO;QAAA;UAAA;YAAA;cAAA;cAAA,OAC7B,CAAC,CAACA,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC6B,MAAM,IAAI,IAAI,CAACK,aAAa,GAAG,IAAI,CAACC,eAAe,EAAEU,MAAM,CAAC,IAAI,CAACP,MAAM,CAACF,MAAM,CAAC,CAAC;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA,CACrJ;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;EAAA;AAAA;AAAA,IAGCc,eAAe;EACjB,2BAAc;IAAA;IACV,IAAI,CAACrG,GAAG,GAAG,CAAC,CAAC;EACjB;EAAC;IAAA;IAAA;MAAA,uEACD,mBAAU8F,GAAG;QAAA;UAAA;YAAA;cAAA,mCACF,IAAI,CAAC9F,GAAG,CAAC8F,GAAG,CAAC,IAAIzC,SAAS;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA,CACpC;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;IAAA;IAAA;MAAA,uEACD,mBAAUyC,GAAG,EAAEC,KAAK;QAAA;UAAA;YAAA;cAChB,IAAI,CAAC/F,GAAG,CAAC8F,GAAG,CAAC,GAAGC,KAAK;YAAC;YAAA;cAAA;UAAA;QAAA;MAAA,CACzB;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;IAAA;IAAA;MAAA,0EACD,mBAAaD,GAAG;QAAA;UAAA;YAAA;cACZ,OAAO,IAAI,CAAC9F,GAAG,CAAC8F,GAAG,CAAC;YAAC;YAAA;cAAA;UAAA;QAAA;MAAA,CACxB;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;EAAA;AAAA;AAAA,IAGCQ,kBAAkB;EAAA;EAAA;EACpB,4BAAY5E,OAAO,EAAE;IAAA;IAAA,yBACXA,OAAO;EACjB;EAAC;AAAA,iCAH4BjB,KAAK;AAAA,IAMhC8F,mBAAmB;EAAA;EAAA;EACrB,6BAAYC,UAAU,EAAE;IAAA;IAAA,qCACVA,UAAU;EACxB;EAAC;AAAA,iCAH6B/F,KAAK;AAAA,IAMjCgG,oBAAoB;EAAA;EAAA;EACtB,8BAAYC,aAAa,EAAE;IAAA;IAAA;IACvB,yFAA6DA,aAAa;IAC1E,MAAKA,aAAa,GAAGA,aAAa;IAAC;EACvC;EAAC;AAAA,iCAJ8BjG,KAAK;AAAA,IAOlCkG,iBAAiB;EAAA;EAAA;EACnB,2BAAYjF,OAAO,EAAEkF,KAAK,EAAEC,gBAAgB,EAAE;IAAA;IAAA;IAC1C,4BAAMnF,OAAO;IACb,OAAKkF,KAAK,GAAGA,KAAK;IAClB,OAAKC,gBAAgB,GAAGA,gBAAgB;IAAC;EAC7C;EAAC;AAAA,iCAL2BpG,KAAK;AAQrC,SAASqG,YAAY,CAAC/E,QAAQ,EAAE;EAC5B,IAAMgF,WAAW,GAAG,IAAI1E,GAAG,CAACN,QAAQ,CAAC;EACrC,OAAO,IAAIM,GAAG,CAAC0E,WAAW,CAACC,QAAQ,EAAED,WAAW,CAACE,MAAM,CAAC,CAACjG,QAAQ,EAAE;AACvE;AAAC,SACckG,gBAAgB;EAAA;AAAA;AAAA;EAAA,+EAA/B,mBAAgCnF,QAAQ,EAAEoF,MAAM,EAAElC,OAAO;IAAA;MAAA;QAAA;UAAA,mCAC9C,IAAI1G,OAAO,CAAC;YACf6I,GAAG,EAAEN,YAAY,CAAC/E,QAAQ,CAAC;YAC3BsF,GAAG,EAAEF,MAAM,CAACG,WAAW,EAAE;YACzBC,GAAG,EAAE9I,EAAE;UACX,CAAC,CAAC,CACG+I,kBAAkB,CAAC;YACpBC,GAAG,EAAE9I,qBAAqB,CAAC,CAAC,CAAC;YAC7B6C,GAAG,EAAEyD,OAAO,CAACC,SAAS;YACtBwC,GAAG,EAAE;UACT,CAAC,CAAC,CACGC,WAAW,EAAE,CACbC,IAAI,CAAC3C,OAAO,CAACE,UAAU,EAAE,CAAC,CAAC,CAAC;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CACpC;EAAA;AAAA;AAAA,SACc0C,mBAAmB;EAAA;AAAA;AAAA;EAAA,kFAAlC;IAAA;IAAA;MAAA;QAAA;UAAA;UAAA,OAC4CrJ,eAAe,CAACG,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAAA;UAAA;UAAzEwG,UAAU,yBAAVA,UAAU;UAAED,SAAS,yBAATA,SAAS;UAAA,gBAEzBC,UAAU;UAAA;UAAA,OACO7G,SAAS,CAAC4G,SAAS,CAAC;QAAA;UAAA;UAFnC4C,WAAW;YACb3C,UAAU;YACVD,SAAS;UAAA;UAEZ4C,WAAW,CAAC5C,SAAS,CAACuC,GAAG,GAAI9I,qBAAqB;UAAA,mCAC5CmJ,WAAW;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CACrB;EAAA;AAAA;AAED,IAAMC,+BAA+B,GAAG,GAAG;AAC3C,SAASC,mBAAmB,CAACC,UAAU,EAAE;EACrC,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAACzF,QAAQ,CAACyF,UAAU,CAAC;AAC1C;AAAC,SACcC,qBAAqB;EAAA;AAAA;AAAA;EAAA,oFAApC,mBAAqCC,SAAS,EAAEC,SAAS,EAAEnD,OAAO,EAAEoD,cAAc;IAAA;IAAA;MAAA;QAAA;UAExEC,OAAO,GAAG,IAAInK,OAAO,CAACkK,cAAc,KAAK,IAAI,IAAIA,cAAc,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,cAAc,CAACC,OAAO,CAAC;UACnHA,OAAO,CAACzC,GAAG,CAAC,eAAe,iBAAUuC,SAAS,EAAG;UAAC,gBAClDE,OAAO;UAAA;UAAA,OAAmBpB,gBAAgB,CAACiB,SAAS,EAAE,CAACvF,EAAE,GAAGyF,cAAc,KAAK,IAAI,IAAIA,cAAc,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,cAAc,CAAClB,MAAM,MAAM,IAAI,IAAIvE,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,KAAK,EAAEqC,OAAO,CAAC;QAAA;UAAA;UAAA,cAA3LY,GAAG,qBAAC,MAAM;UAAA,mEAEXwC,cAAc;YACjBC,OAAO,EAAPA;UAAO;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CAEd;EAAA;AAAA;AAAA,SACcC,yBAAyB;EAAA;AAAA;AAAA;EAAA,wFAAxC,mBAAyCJ,SAAS,EAAEC,SAAS,EAAEnD,OAAO,EAAEoD,cAAc;IAAA;IAAA;MAAA;QAAA;UAAA,MAC9EpD,OAAO,KAAK5B,SAAS;YAAA;YAAA;UAAA;UAAA,mCACd6E,qBAAqB,CAACC,SAAS,EAAEC,SAAS,EAAEnD,OAAO,EAAEoD,cAAc,CAAC;QAAA;UAEzEC,OAAO,GAAG,IAAInK,OAAO,CAACkK,cAAc,KAAK,IAAI,IAAIA,cAAc,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,cAAc,CAACC,OAAO,CAAC;UACnHA,OAAO,CAACzC,GAAG,CAAC,eAAe,mBAAYuC,SAAS,EAAG;UAAC,mEAE7CC,cAAc;YACjBC,OAAO,EAAPA;UAAO;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CAEd;EAAA;AAAA;AAAA,SACcE,wBAAwB;EAAA;AAAA;AAAA;EAAA,uFAAvC,mBAAwCC,WAAW,EAAEC,WAAW,EAAE/F,GAAG,EAAEgG,kBAAkB,EAAE1D,OAAO;IAAA;MAAA;QAAA;UAAA,gBACvFwD,WAAW;UAAA,gBAAC9F,GAAG;UAAA;UAAA,OAAQ4F,yBAAyB,CAAC5F,GAAG,CAAC3B,QAAQ,EAAE,EAAE0H,WAAW,EAAEzD,OAAO,EAAE0D,kBAAkB,CAAC;QAAA;UAAA;UAAA;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CACpH;EAAA;AAAA;AAAA,SACcC,kBAAkB;EAAA;AAAA;AAAA;EAAA,iFAAjC,mBAAkCC,cAAc,EAAE5D,OAAO,EAAE6D,YAAY;IAAA;IAAA;MAAA;QAAA;UAAA;UAAA,OAE5CD,cAAc,CAACE,cAAc,CAACC,OAAO,CAACH,cAAc,CAACjF,SAAS,EAAEiF,cAAc,CAAC9D,YAAY,EAAEE,OAAO,CAAC;QAAA;UAAtHgE,QAAQ;UACdH,YAAY,KAAK,IAAI,IAAIA,YAAY,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,YAAY,CAACI,IAAI,CAACtK,MAAM,CAACM,gBAAgB,EAAE,CAAC0D,EAAE,GAAGqG,QAAQ,CAACE,SAAS,MAAM,IAAI,IAAIvG,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAGmF,+BAA+B,CAAC;UAClM,IAAI,OAAOkB,QAAQ,CAAClE,YAAY,KAAK,QAAQ,EAAE;YAC3C+D,YAAY,KAAK,IAAI,IAAIA,YAAY,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,YAAY,CAACI,IAAI,CAACtK,MAAM,CAACI,iBAAiB,EAAEiK,QAAQ,CAAClE,YAAY,CAAC;UAClI;UAAC,mCACM;YACH2D,WAAW,EAAEO,QAAQ,CAACP,WAAW;YACjC3D,YAAY,EAAEkE,QAAQ,CAAClE,YAAY;YACnCoE,SAAS,EAAEF,QAAQ,CAACE;UACxB,CAAC;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CACJ;EAAA;AAAA;AACD,IAAMC,mBAAmB,GAAG,SAAtBA,mBAAmB,CAAID,SAAS,EAAK;EACvC,IAAIA,SAAS,KAAK9F,SAAS,EAAE;IACzB,OAAO8F,SAAS,GAAG9J,iCAAiC,GAAG,CAAC,GAEhD8J,SAAS,GAAG9J,iCAAiC,GAC/C8J,SAAS;EACnB;EACA,OAAOpB,+BAA+B;AAC1C,CAAC;AAAC,SACasB,uBAAuB;EAAA;AAAA;AAAA;EAAA,sFAAtC,mBAAuCZ,WAAW,EAAEC,WAAW,EAAEvF,OAAO;IAAA;IAAA;MAAA;QAAA;UAEhEmG,kBAAkB,GAAGZ,WAAW;UAE9Ba,qBAAqB,GAAGpG,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC0F,cAAc;UACtG,IAAIU,qBAAqB,KAAKlG,SAAS,EAAE;YAC/BmG,uBAAuB;cAAA,sEAAG;gBAAA;gBAAA;kBAAA;oBAAA;sBAAA;sBAAA;sBAAA,OAGsDZ,kBAAkB,CAACW,qBAAqB,EAAEpG,OAAO,CAAC8B,OAAO,EAAE9B,OAAO,CAAC2F,YAAY,CAAC;oBAAA;sBAAA;sBAAzIW,oBAAoB,yBAAjCf,WAAW;sBAAwB3D,YAAY,yBAAZA,YAAY;sBAAEoE,SAAS,yBAATA,SAAS;sBAClEG,kBAAkB,GAAGG,oBAAoB;sBACzC,IAAI1E,YAAY,KAAK1B,SAAS,EAAE;wBAC5BkG,qBAAqB,CAACxE,YAAY,GAAGA,YAAY;sBACrD;sBACA2E,YAAY,CAACC,aAAa,CAAC;sBAC3BA,aAAa,GAAGC,UAAU,CAACJ,uBAAuB,EAAEJ,mBAAmB,CAACD,SAAS,CAAC,GAAG,IAAI,CAAC;sBAC1F,CAACvG,EAAE,GAAGO,OAAO,CAAC2F,YAAY,MAAM,IAAI,IAAIlG,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACsG,IAAI,CAACtK,MAAM,CAACQ,WAAW,EAAEuK,aAAa,CAAC;sBAAC;sBAAA;oBAAA;sBAAA;sBAAA;sBAG5G,IAAI,yBAAahD,iBAAiB,EAAE;wBAChC,CAACkD,EAAE,GAAG1G,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC2F,YAAY,MAAM,IAAI,IAAIe,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACX,IAAI,CAACtK,MAAM,CAACC,KAAK,EAAE,cAAE+H,KAAK,EAAE,cAAEC,gBAAgB,CAAC;wBACrK,CAACiD,EAAE,GAAG3G,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC2F,YAAY,MAAM,IAAI,IAAIgB,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACZ,IAAI,CAACtK,MAAM,CAACK,eAAe,CAAC;sBACtJ;sBACA,IAAI,yBAAawH,oBAAoB,IACjC,cAAEC,aAAa,CAAClE,QAAQ,CAAC,cAAc,CAAC,EAAE;wBAC1C,CAACuH,EAAE,GAAG5G,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC2F,YAAY,MAAM,IAAI,IAAIiB,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACb,IAAI,CAACtK,MAAM,CAACK,eAAe,CAAC;sBACtJ;oBAAC;oBAAA;sBAAA;kBAAA;gBAAA;cAAA,CAER;cAAA,gBAtBKuK,uBAAuB;gBAAA;cAAA;YAAA;YAuB7BG,aAAa,GAAGC,UAAU,CAACJ,uBAAuB,EAAEJ,mBAAmB,CAACjG,OAAO,CAACgG,SAAS,CAAC,GAAG,IAAI,CAAC;YAClG,CAACvG,EAAE,GAAGO,OAAO,CAAC2F,YAAY,MAAM,IAAI,IAAIlG,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACsG,IAAI,CAACtK,MAAM,CAACQ,WAAW,EAAEuK,aAAa,CAAC;UAC/G,CAAC,MACI,IAAIxG,OAAO,KAAKE,SAAS,IAAIF,OAAO,CAAC2F,YAAY,KAAKzF,SAAS,EAAE;YAC5D2G,iBAAiB,GAAGJ,UAAU,CAAC,YAAM;cACvCzG,OAAO,CAAC2F,YAAY,CAACI,IAAI,CAACtK,MAAM,CAACK,eAAe,CAAC;YACrD,CAAC,EAAEmK,mBAAmB,CAACjG,OAAO,CAACgG,SAAS,CAAC,GAAG,IAAI,CAAC;YACjDhG,OAAO,CAAC2F,YAAY,CAACI,IAAI,CAACtK,MAAM,CAACQ,WAAW,EAAE4K,iBAAiB,CAAC;UACpE;UAAC;YAAA,uEACM,mBAAOrH,GAAG,EAAEsH,WAAW;cAAA;cAAA;gBAAA;kBAAA;oBAAA;oBAAA,OACLzB,wBAAwB,CAACC,WAAW,EAAEa,kBAAkB,EAAE3G,GAAG,EAAEsH,WAAW,EAAE9G,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC8B,OAAO,CAAC;kBAAA;oBAA/JiF,QAAQ;oBACNC,6BAA6B,GAAG,CAACD,QAAQ,CAACE,EAAE,IAAI,CAACpC,mBAAmB,CAACkC,QAAQ,CAAC7I,MAAM,CAAC;oBAAA,MACvF6I,QAAQ,CAACE,EAAE,IAAID,6BAA6B;sBAAA;sBAAA;oBAAA;oBAAA,mCACrCD,QAAQ;kBAAA;oBAEbG,iBAAiB,GAAGH,QAAQ,CAACvH,GAAG,KAAKA,GAAG;oBAAA,MAC1C0H,iBAAiB,IAAI,CAAClH,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC8B,OAAO,MAAM5B,SAAS;sBAAA;sBAAA;oBAAA;oBAAA;oBAAA,OACrFmF,wBAAwB,CAACC,WAAW,EAAEa,kBAAkB,EAAEY,QAAQ,CAACvH,GAAG,EAAEsH,WAAW,EAAE9G,OAAO,CAAC8B,OAAO,CAAC;kBAAA;oBAAtHiF,QAAQ;kBAAA;oBAAA,mCAELA,QAAQ;kBAAA;kBAAA;oBAAA;gBAAA;cAAA;YAAA,CAClB;YAAA;cAAA;YAAA;UAAA;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CACJ;EAAA;AAAA;AAED,IAAMI,yBAAyB,GAAG,aAAa;AAC/C,IAAMC,kBAAkB,GAAG;EACvB/E,GAAG;IAAA,uEAAE,mBAAOM,GAAG,EAAE3C,OAAO;MAAA;QAAA;UAAA;YAAA,mCAAKmH,yBAAyB;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;IAAA;MAAA;IAAA;IAAA;EAAA;EACtDzE,GAAG;IAAA,uEAAE,mBAAOC,GAAG,EAAEC,KAAK;MAAA;QAAA;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA,CACrB;IAAA;MAAA;IAAA;IAAA;EAAA;EACDC,MAAM;IAAA,0EAAE,mBAAOF,GAAG;MAAA;QAAA;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA,CACjB;IAAA;MAAA;IAAA;IAAA;EAAA;EACD3B,UAAU;IAAA,8EAAE,mBAAOoB,MAAM,EAAEO,GAAG,EAAE3C,OAAO;MAAA;QAAA;UAAA;YAAA,mCAAKmH,yBAAyB;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;IAAA;MAAA;IAAA;IAAA;EAAA;EACrEvG,UAAU;IAAA,8EAAE,mBAAOwB,MAAM,EAAEY,MAAM,EAAEhD,OAAO;MAAA;QAAA;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA,CACzC;IAAA;MAAA;IAAA;IAAA;EAAA;EACDuB,aAAa;IAAA,iFAAE,mBAAOa,MAAM,EAAEO,GAAG,EAAE3C,OAAO;MAAA;QAAA;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA,CACzC;IAAA;MAAA;IAAA;IAAA;EAAA;EACDqH,iBAAiB;IAAA,qFAAE,mBAAOjF,MAAM,EAAEpC,OAAO;MAAA;QAAA;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA,CACxC;IAAA;MAAA;IAAA;IAAA;EAAA;AACL,CAAC;AACD,IAAMsH,WAAW,GAAG,SAAdA,WAAW,CAAI/E,MAAM,EAAK;EAC5B,IAAMgF,KAAK,GAAGhF,MAAM;EACpB,OAAO;IACHF,GAAG;MAAA,uEAAE,mBAAOM,GAAG;QAAA;UAAA;YAAA;cAAA,MACP4E,KAAK,CAAC5E,GAAG,CAAC,KAAKzC,SAAS;gBAAA;gBAAA;cAAA;cAAA,mCACjBA,SAAS;YAAA;cAAA,MAEhB,OAAOqH,KAAK,CAAC5E,GAAG,CAAC,KAAK,QAAQ;gBAAA;gBAAA;cAAA;cAAA,mCACvB4E,KAAK,CAAC5E,GAAG,CAAC;YAAA;cAAA,mCAEdjF,IAAI,CAACC,SAAS,CAAC4J,KAAK,CAAC5E,GAAG,CAAC,CAAC;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA,CACpC;MAAA;QAAA;MAAA;MAAA;IAAA;IACDD,GAAG;MAAA,uEAAE,mBAAOC,GAAG,EAAEC,KAAK;QAAA;UAAA;YAAA;cAClB2E,KAAK,CAAC5E,GAAG,CAAC,GAAGC,KAAK;YAAC;YAAA;cAAA;UAAA;QAAA;MAAA,CACtB;MAAA;QAAA;MAAA;MAAA;IAAA;IACDC,MAAM;MAAA,0EAAE,mBAAOF,GAAG;QAAA;UAAA;YAAA;cACd,OAAO4E,KAAK,CAAC5E,GAAG,CAAC;YAAC;YAAA;cAAA;UAAA;QAAA;MAAA,CACrB;MAAA;QAAA;MAAA;MAAA;IAAA;EACL,CAAC;AACL,CAAC;AACD,IAAM6E,kBAAkB,GAAG,SAArBA,kBAAkB,CAAIjF,MAAM,EAAuB;EAAA,IAArBkF,QAAQ,uEAAG,KAAK;EAChD,IAAIA,QAAQ,EAAE;IACV,OAAO,IAAIxF,cAAc,CAACqF,WAAW,CAAC/E,MAAM,CAAC,EAAE+E,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;EACnE;EACA,OAAO,IAAIrF,cAAc,CAACqF,WAAW,CAAC,CAAC,CAAC,CAAC,EAAEA,WAAW,CAAC/E,MAAM,CAAC,CAAC;AACnE,CAAC;AAED,SAAS/F,gBAAgB,EAAE2G,kBAAkB,EAAE7G,cAAc,EAAEb,MAAM,EAAEyH,eAAe,EAAEI,oBAAoB,EAAEF,mBAAmB,EAAEI,iBAAiB,EAAEhI,qBAAqB,EAAEU,iCAAiC,EAAEX,6BAA6B,EAAE0G,cAAc,EAAEkF,yBAAyB,EAAEC,kBAAkB,EAAE9H,mBAAmB,EAAE4G,uBAAuB,EAAEnC,gBAAgB,EAAErE,mBAAmB,EAAE5B,SAAS,EAAE4G,mBAAmB,EAAE5D,0BAA0B,EAAEtC,wBAAwB,EAAE4B,kBAAkB,EAAEjB,oBAAoB,EAAE8B,0BAA0B,EAAEqG,WAAW,EAAEE,kBAAkB,EAAE/F,wBAAwB"},"metadata":{},"sourceType":"module","externalDependencies":[]}