{"ast":null,"code":"import _regeneratorRuntime from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _get from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/get.js\";\nimport _getPrototypeOf from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";\nimport _inherits from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"E:/react-todo-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport fetchJwks from '../runtime/fetch_jwks.js';\nimport { isCloudflareWorkers } from '../runtime/env.js';\nimport { JWKSInvalid, JWKSNoMatchingKey } from '../util/errors.js';\nimport { isJWKSLike, LocalJWKSet } from './local.js';\nvar RemoteJWKSet = /*#__PURE__*/function (_LocalJWKSet) {\n  _inherits(RemoteJWKSet, _LocalJWKSet);\n  var _super = _createSuper(RemoteJWKSet);\n  function RemoteJWKSet(url, options) {\n    var _this;\n    _classCallCheck(this, RemoteJWKSet);\n    _this = _super.call(this, {\n      keys: []\n    });\n    _this._jwks = undefined;\n    if (!(url instanceof URL)) {\n      throw new TypeError('url must be an instance of URL');\n    }\n    _this._url = new URL(url.href);\n    _this._options = {\n      agent: options === null || options === void 0 ? void 0 : options.agent,\n      headers: options === null || options === void 0 ? void 0 : options.headers\n    };\n    _this._timeoutDuration = typeof (options === null || options === void 0 ? void 0 : options.timeoutDuration) === 'number' ? options === null || options === void 0 ? void 0 : options.timeoutDuration : 5000;\n    _this._cooldownDuration = typeof (options === null || options === void 0 ? void 0 : options.cooldownDuration) === 'number' ? options === null || options === void 0 ? void 0 : options.cooldownDuration : 30000;\n    _this._cacheMaxAge = typeof (options === null || options === void 0 ? void 0 : options.cacheMaxAge) === 'number' ? options === null || options === void 0 ? void 0 : options.cacheMaxAge : 600000;\n    return _this;\n  }\n  _createClass(RemoteJWKSet, [{\n    key: \"coolingDown\",\n    value: function coolingDown() {\n      return typeof this._jwksTimestamp === 'number' ? Date.now() < this._jwksTimestamp + this._cooldownDuration : false;\n    }\n  }, {\n    key: \"fresh\",\n    value: function fresh() {\n      return typeof this._jwksTimestamp === 'number' ? Date.now() < this._jwksTimestamp + this._cacheMaxAge : false;\n    }\n  }, {\n    key: \"getKey\",\n    value: function () {\n      var _getKey = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(protectedHeader, token) {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (!(!this._jwks || !this.fresh())) {\n                _context.next = 3;\n                break;\n              }\n              _context.next = 3;\n              return this.reload();\n            case 3:\n              _context.prev = 3;\n              _context.next = 6;\n              return _get(_getPrototypeOf(RemoteJWKSet.prototype), \"getKey\", this).call(this, protectedHeader, token);\n            case 6:\n              return _context.abrupt(\"return\", _context.sent);\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](3);\n              if (!(_context.t0 instanceof JWKSNoMatchingKey)) {\n                _context.next = 16;\n                break;\n              }\n              if (!(this.coolingDown() === false)) {\n                _context.next = 16;\n                break;\n              }\n              _context.next = 15;\n              return this.reload();\n            case 15:\n              return _context.abrupt(\"return\", _get(_getPrototypeOf(RemoteJWKSet.prototype), \"getKey\", this).call(this, protectedHeader, token));\n            case 16:\n              throw _context.t0;\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this, [[3, 9]]);\n      }));\n      function getKey(_x, _x2) {\n        return _getKey.apply(this, arguments);\n      }\n      return getKey;\n    }()\n  }, {\n    key: \"reload\",\n    value: function () {\n      var _reload = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var _this2 = this;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(this._pendingFetch && isCloudflareWorkers())) {\n                _context2.next = 2;\n                break;\n              }\n              return _context2.abrupt(\"return\", new Promise(function (resolve) {\n                var isDone = function isDone() {\n                  if (_this2._pendingFetch === undefined) {\n                    resolve();\n                  } else {\n                    setTimeout(isDone, 5);\n                  }\n                };\n                isDone();\n              }));\n            case 2:\n              if (!this._pendingFetch) {\n                this._pendingFetch = fetchJwks(this._url, this._timeoutDuration, this._options).then(function (json) {\n                  if (!isJWKSLike(json)) {\n                    throw new JWKSInvalid('JSON Web Key Set malformed');\n                  }\n                  _this2._jwks = {\n                    keys: json.keys\n                  };\n                  _this2._jwksTimestamp = Date.now();\n                  _this2._pendingFetch = undefined;\n                }).catch(function (err) {\n                  _this2._pendingFetch = undefined;\n                  throw err;\n                });\n              }\n              _context2.next = 5;\n              return this._pendingFetch;\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function reload() {\n        return _reload.apply(this, arguments);\n      }\n      return reload;\n    }()\n  }]);\n  return RemoteJWKSet;\n}(LocalJWKSet);\nexport function createRemoteJWKSet(url, options) {\n  return RemoteJWKSet.prototype.getKey.bind(new RemoteJWKSet(url, options));\n}","map":{"version":3,"names":["fetchJwks","isCloudflareWorkers","JWKSInvalid","JWKSNoMatchingKey","isJWKSLike","LocalJWKSet","RemoteJWKSet","url","options","keys","_jwks","undefined","URL","TypeError","_url","href","_options","agent","headers","_timeoutDuration","timeoutDuration","_cooldownDuration","cooldownDuration","_cacheMaxAge","cacheMaxAge","_jwksTimestamp","Date","now","protectedHeader","token","fresh","reload","coolingDown","_pendingFetch","Promise","resolve","isDone","setTimeout","then","json","catch","err","createRemoteJWKSet","prototype","getKey","bind"],"sources":["E:/react-todo-app/node_modules/jose/dist/browser/jwks/remote.js"],"sourcesContent":["import fetchJwks from '../runtime/fetch_jwks.js';\nimport { isCloudflareWorkers } from '../runtime/env.js';\nimport { JWKSInvalid, JWKSNoMatchingKey } from '../util/errors.js';\nimport { isJWKSLike, LocalJWKSet } from './local.js';\nclass RemoteJWKSet extends LocalJWKSet {\n    constructor(url, options) {\n        super({ keys: [] });\n        this._jwks = undefined;\n        if (!(url instanceof URL)) {\n            throw new TypeError('url must be an instance of URL');\n        }\n        this._url = new URL(url.href);\n        this._options = { agent: options === null || options === void 0 ? void 0 : options.agent, headers: options === null || options === void 0 ? void 0 : options.headers };\n        this._timeoutDuration =\n            typeof (options === null || options === void 0 ? void 0 : options.timeoutDuration) === 'number' ? options === null || options === void 0 ? void 0 : options.timeoutDuration : 5000;\n        this._cooldownDuration =\n            typeof (options === null || options === void 0 ? void 0 : options.cooldownDuration) === 'number' ? options === null || options === void 0 ? void 0 : options.cooldownDuration : 30000;\n        this._cacheMaxAge = typeof (options === null || options === void 0 ? void 0 : options.cacheMaxAge) === 'number' ? options === null || options === void 0 ? void 0 : options.cacheMaxAge : 600000;\n    }\n    coolingDown() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cooldownDuration\n            : false;\n    }\n    fresh() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cacheMaxAge\n            : false;\n    }\n    async getKey(protectedHeader, token) {\n        if (!this._jwks || !this.fresh()) {\n            await this.reload();\n        }\n        try {\n            return await super.getKey(protectedHeader, token);\n        }\n        catch (err) {\n            if (err instanceof JWKSNoMatchingKey) {\n                if (this.coolingDown() === false) {\n                    await this.reload();\n                    return super.getKey(protectedHeader, token);\n                }\n            }\n            throw err;\n        }\n    }\n    async reload() {\n        if (this._pendingFetch && isCloudflareWorkers()) {\n            return new Promise((resolve) => {\n                const isDone = () => {\n                    if (this._pendingFetch === undefined) {\n                        resolve();\n                    }\n                    else {\n                        setTimeout(isDone, 5);\n                    }\n                };\n                isDone();\n            });\n        }\n        if (!this._pendingFetch) {\n            this._pendingFetch = fetchJwks(this._url, this._timeoutDuration, this._options)\n                .then((json) => {\n                if (!isJWKSLike(json)) {\n                    throw new JWKSInvalid('JSON Web Key Set malformed');\n                }\n                this._jwks = { keys: json.keys };\n                this._jwksTimestamp = Date.now();\n                this._pendingFetch = undefined;\n            })\n                .catch((err) => {\n                this._pendingFetch = undefined;\n                throw err;\n            });\n        }\n        await this._pendingFetch;\n    }\n}\nexport function createRemoteJWKSet(url, options) {\n    return RemoteJWKSet.prototype.getKey.bind(new RemoteJWKSet(url, options));\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}